"use strict";function ownKeys(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _regeneratorRuntime(){_regeneratorRuntime=function(){return a};var a={},e=Object.prototype,c=e.hasOwnProperty,u=Object.defineProperty||function(e,t,n){e[t]=n.value},t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function o(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(e){o=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var i,o,a,s,t=t&&t.prototype instanceof f?t:f,t=Object.create(t.prototype),r=new b(r||[]);return u(t,"_invoke",{value:(i=e,o=n,a=r,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(a.method=e,a.arg=t;;){var n=a.delegate;if(n){n=function e(t,n){var r=n.method,i=t.iterator[r];if(void 0===i)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=void 0,e(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;r=l(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,p;i=r.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,p):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}(n,a);if(n){if(n===p)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";n=l(i,o,a);if("normal"===n.type){if(s=a.done?"completed":"suspendedYield",n.arg===p)continue;return{value:n.arg,done:a.done}}"throw"===n.type&&(s="completed",a.method="throw",a.arg=n.arg)}})}),t}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}a.wrap=s;var p={};function f(){}function d(){}function h(){}var t={},g=(o(t,r,function(){return this}),Object.getPrototypeOf),g=g&&g(g(S([]))),_=(g&&g!==e&&c.call(g,r)&&(t=g),h.prototype=f.prototype=Object.create(t));function m(e){["next","throw","return"].forEach(function(t){o(e,t,function(e){return this._invoke(t,e)})})}function v(a,s){var t;u(this,"_invoke",{value:function(n,r){function e(){return new s(function(e,t){!function t(e,n,r,i){var o,e=l(a[e],a,n);if("throw"!==e.type)return(n=(o=e.arg).value)&&"object"==typeof n&&c.call(n,"__await")?s.resolve(n.__await).then(function(e){t("next",e,r,i)},function(e){t("throw",e,r,i)}):s.resolve(n).then(function(e){o.value=e,r(o)},function(e){return t("throw",e,r,i)});i(e.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}})}function y(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(y,this),this.reset(!0)}function S(t){if(t||""===t){var n,e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}throw new TypeError(typeof t+" is not iterable")}return u(_,"constructor",{value:d.prototype=h,configurable:!0}),u(h,"constructor",{value:d,configurable:!0}),d.displayName=o(h,i,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,o(e,i,"GeneratorFunction")),e.prototype=Object.create(_),e},a.awrap=function(e){return{__await:e}},m(v.prototype),o(v.prototype,n,function(){return this}),a.AsyncIterator=v,a.async=function(e,t,n,r,i){void 0===i&&(i=Promise);var o=new v(s(e,t,n,r),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},m(_),o(_,i,"Generator"),o(_,r,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,n=Object(e),r=[];for(t in n)r.push(t);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return o.type="throw",o.arg=n,r.next=e,t&&(r.method="next",r.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&c.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,r,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(n=i.completion).type&&(r=n.arg,k(i)),r}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},a}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function _asyncToGenerator(s){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=s.apply(e,a);function i(e){asyncGeneratorStep(r,t,n,i,o,"next",e)}function o(e){asyncGeneratorStep(r,t,n,i,o,"throw",e)}i(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _createForOfIteratorHelper(e,t){var n,r,i,o,a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return r=!(n=!0),{s:function(){a=a.call(e)},n:function(){var e=a.next();return n=e.done,e},e:function(e){r=!0,i=e},f:function(){try{n||null==a.return||a.return()}finally{if(r)throw i}}};if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return a&&(e=a),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==typeof e?e:String(e)}var Config={LIB_VERSION:"4.8.48",LIB_NAME:"MP",LIB_STACK:"MiniProgram",BASE_URL:"https://backend.gravity-engine.com/event_center/api/v1"},PlatformProxy=function(){function e(){_classCallCheck(this,e),this.config={persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_web"}}return _createClass(e,[{key:"getConfig",value:function(){return this.config}},{key:"getStorage",value:function(e,t,n){e=localStorage.getItem(e);if(!t)return _.isJSONString(e)?JSON.parse(e):{};_.isJSONString(e)?n(JSON.parse(e)):n({})}},{key:"setStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"removeStorage",value:function(e){localStorage.removeItem(e)}},{key:"_setSystemProxy",value:function(e){this._sysCallback=e}},{key:"getSystemInfo",value:function(e){var t=this._getOs(),t={mp_platform:"web",system:t,platform:t,screenWidth:window.screen.width,screenHeight:window.screen.height,systemLanguage:navigator.language};this._sysCallback&&(t=_.extend(t,this._sysCallback(e))),e.success(t),e.complete()}},{key:"_getOs",value:function(){var e=navigator.userAgent;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":/Android/.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"MacOS":/Linux/.test(e)?"Linux":/CrOS/.test(e)?"ChromeOS":""}},{key:"getNetworkType",value:function(e){e.complete()}},{key:"onNetworkStatusChange",value:function(){}},{key:"request",value:function(e){var t={},n=new XMLHttpRequest;if(n.open(e.method,e.url),e.header)for(var r in e.header)n.setRequestHeader(r,e.header[r]);return n.onreadystatechange=function(){4===n.readyState&&200===n.status?(t.statusCode=200,_.isJSONString(n.responseText)&&(t.data=JSON.parse(n.responseText)),e.success(t)):200!==n.status&&(t.errMsg="network error",e.fail(t))},n.ontimeout=function(){t.errMsg="timeout",e.fail(t)},n.send(e.data),n}},{key:"initAutoTrackInstance",value:function(e,t){this.instance=e,this.autoTrack=t.autoTrack;var n=this;"onpagehide"in window?window.onpagehide=function(){n.onPageHide(!0)}:window.onbeforeunload=function(){n.onPageHide(!0)},n.onPageShow(),n.autoTrack.appHide&&n.instance.timeEvent("ta_page_hide"),"onvisibilitychange"in document&&(document.onvisibilitychange=function(){document.hidden?n.onPageHide(!1):(n.onPageShow(),n.autoTrack.appHide&&n.instance.timeEvent("ta_page_hide"))})}},{key:"setGlobal",value:function(e,t){window[t]=e}},{key:"getAppOptions",value:function(){}},{key:"showToast",value:function(){}},{key:"onPageShow",value:function(){var e;this.autoTrack.appShow&&(_.extend(e={},this.autoTrack.properties),_.isFunction(this.autoTrack.callback)&&_.extend(e,this.autoTrack.callback("appShow")),this.instance._internalTrack("$WebPageView",e))}},{key:"onPageHide",value:function(e){var t;this.autoTrack.appHide&&(_.extend(t={},this.autoTrack.properties),_.isFunction(this.autoTrack.callback)&&_.extend(t,this.autoTrack.callback("appHide")),this.instance._internalTrack("$WebPageHide",t,new Date,null,e))}}],[{key:"createInstance",value:function(){return new e}}]),e}(),AutoTrackBridge=function(){function n(e,t){_classCallCheck(this,n),this.taInstance=e,this.config=t||{},this.referrer="Directly open",this.config.isPlugin?(e.App=function(){App.apply(this,arguments)},inension(e.Page)):(t=App,App=this._initAppExtention(t),e=Page,Page=this._initPageExtension(e))}return _createClass(n,[{key:"_initPageExtension",value:function(i){var o=this;return function(e){var t=e.onLoad,n=e.onShow,r=(e.onShareAppMessage,{});return e.onLoad=function(e){r=e||{},"function"==typeof t&&t.call(this,e)},e.onShow=function(e){o.onPageShow(r),"function"==typeof n&&n.call(this,e)},i(e)}}},{key:"_initAppExtention",value:function(i){var o=this;return function(e){var t=e.onLaunch,n=e.onShow,r=e.onHide;return e.onLaunch=function(e){o.onAppLaunch(e,this),"function"==typeof t&&t.call(this,e)},e.onShow=function(e){o.onAppShow(e),"function"==typeof n&&n.call(this,e)},e.onHide=function(){o.onAppHide(),"function"==typeof r&&r.call(this)},i(e)}}},{key:"onAppLaunch",value:function(e,t){this._setAutoTrackProperties(e),_.isUndefined(t)||(t[this.taInstance.name]=this.taInstance),this.config.appLaunch&&(t={},e&&e.path&&(t.$url_query=_.setQuery(e.query),t.$scene=String(e.scene||e.from)),this.taInstance._internalTrack("$MPLaunch",t))}},{key:"onAppShow",value:function(e){var t;this.config.appHide&&this.taInstance.timeEvent("$MPHide"),this._setAutoTrackProperties(e),this.config.appShow&&(t={},e&&e.path&&(t.$url_path=this._getPath(e.path),t.$url_query=_.setQuery(e.query),t.$scene=String(e.scene||e.from)),_.extend(t,this.config.properties),_.isFunction(this.config.callback)&&_.extend(t,this.config.callback("appShow")),this.taInstance._internalTrack("$MPShow",t))}},{key:"onAppHide",value:function(){var e;this.config.appHide&&(_.extend(e={},this.config.properties),_.isFunction(this.config.callback)&&_.extend(e,this.config.callback("appHide")),this.taInstance._internalTrack("$MPHide",e))}},{key:"_getCurrentPath",value:function(){var e="Not to get";try{var t=getCurrentPages(),e=t[t.length-1].route}catch(e){logger.info(e)}return e}},{key:"_setAutoTrackProperties",value:function(e){this.taInstance._setAutoTrackProperties({})}},{key:"_getPath",value:function(e){return"string"==typeof e?e.replace(/^\//,""):"Abnormal values"}},{key:"onPageShare",value:function(e){if(this.config.pageShare){var t=1;try{t=getCurrentPages().length}catch(e){t=1}this.taInstance._internalTrack("$MPShare",{$share_method:"转发消息卡片",$share_depth:t,$url_path:this._getCurrentPath()})}return _.isObject(e)?e:{}}},{key:"onPageShow",value:function(e){var t;this.config.pageShow&&(t=this._getCurrentPath(),_.setQuery(e),this.referrer=t)}}]),n}(),AutoTrackBridge$1=function(){function i(t,e,n){var r=this,t=(_classCallCheck(this,i),this.taInstance=t,this.config=e||{},{});try{t=n.getLaunchOptionsSync()}catch(e){t={}}this._onShow(t),this.startTracked=!0,n.onShow(function(e){r._onShow(e)}),n.onHide(function(){var e;r.startTracked=!1,r.config.appHide&&(_.extend(e={},r.config.properties),_.isFunction(r.config.callback)&&_.extend(e,r.config.callback("appHide")),r.taInstance._internalTrack("$MPHide",e))})}return _createClass(i,[{key:"_onShow",value:function(e){var t;_.isObject(e)||(e={}),this.startTracked||(this.config.appHide&&this.taInstance.timeEvent("$MPHide"),this.config.appShow&&(_.extend(t={},this.config.properties),_.isFunction(this.config.callback)&&_.extend(t,this.config.callback("appShow")),this.taInstance._internalTrack("$MPShow",_objectSpread2(_objectSpread2({},t),{},{$scene:String((null==(t=e)?void 0:t.scene)||(null==(t=e)?void 0:t.from)),$url_query:_.setQuery((null==(e=PlatformAPI.getAppOptions())?void 0:e.query)||{})}))))}}]),i}();function xhrRequest(e){var t={},n=new XMLHttpRequest;if(n.open(e.method,e.url),e.header)for(var r in e.header)n.setRequestHeader(r,e.header[r]);return n.onreadystatechange=function(){4===n.readyState&&200===n.status?(t.statusCode=200,_.isJSONString(n.responseText)&&(t.data=JSON.parse(n.responseText)),e.success(t)):200!==n.status&&(t.errMsg="network error",e.fail(t))},n.ontimeout=function(){t.errMsg="timeout",e.fail(t)},n.send(JSON.parse(e.data)),n}var PlatformProxy$1=function(){function r(e,t,n){_classCallCheck(this,r),this.api=e,this.config=t,this._config=n}return _createClass(r,[{key:"getConfig",value:function(){return this.config}},{key:"getStorage",value:function(e,t,n){if(t)this.api.getStorage({key:e,success:function(e){e=_.isJSONString(e.data)?JSON.parse(e.data):{};n(e)},fail:function(){n({})}});else try{var r,i;return["dd_mp","ali_mp","ali_mg"].includes(this._config.platform)?(r=this.api.getStorageSync({key:e}),_.isJSONString(r.data)?JSON.parse(r.data):{}):(i=this.api.getStorageSync(e),_.isJSONString(i)?JSON.parse(i):{})}catch(e){return{}}}},{key:"setStorage",value:function(e,t){try{["ali_mp","tb_mp","dd_mp","ali_mg"].includes(this._config.platform)?this.api.setStorageSync({key:e,data:t}):this.api.setStorageSync(e,t)}catch(e){}}},{key:"removeStorage",value:function(e){try{_.isFunction(this.api.removeStorage)?this.api.removeStorage({key:e}):_.isFunction(this.api.deleteStorage)&&this.api.deleteStorage({key:e})}catch(e){}}},{key:"_getPlatform",value:function(){return""}},{key:"getSystemInfo",value:function(t){var n=this._config.mpPlatform;this.api.getSystemInfo({success:function(e){_.isFunction(n)?e.mp_platform=n(e):e.mp_platform=n,t.success(e),"wechat"===n&&t.complete()},complete:function(){t.complete()}})}},{key:"getNetworkType",value:function(t){_.isFunction(this.api.getNetworkType)?this.api.getNetworkType({success:function(e){t.success(e)},complete:function(){t.complete()}}):(t.success({}),t.complete())}},{key:"onNetworkStatusChange",value:function(e){_.isFunction(this.api.onNetworkStatusChange)?this.api.onNetworkStatusChange(e):e({})}},{key:"request",value:function(t){var e;if("ali_mp"===this._config.platform||"dd_mp"===this._config.platform)return(e=_.extend({},t)).headers=t.header,e.success=function(e){e.statusCode=e.status,t.success(e)},e.fail=function(e){e.errMsg=e.errorMessage,t.fail(e)},"dd_mp"===this._config.platform?this.api.httpRequest(e):this.api.request(e);try{return"taobao_mg"===this._config.platform?xhrRequest(t):this.api.request(t)}catch(e){}}},{key:"initAutoTrackInstance",value:function(e,t){return _.isObject(t.autoTrack)&&(t.autoTrack.isPlugin=t.is_plugin),new(this._config.mp?AutoTrackBridge:AutoTrackBridge$1)(e,t.autoTrack,this.api)}},{key:"setGlobal",value:function(e,t){if(this._config.mp)logger.warn("GravityAnalytics: we do not set global name for GE instance when you do not enable auto track.");else if("ali_mg"!==this._config.platform)try{GameGlobal[t]=e}catch(e){}}},{key:"getAppOptions",value:function(e){var t={};try{t=this.api.getLaunchOptionsSync()}catch(e){t={}}if(_.isFunction(e))try{this._config.mp?this.api.onAppShow(e):this.api.onShow(e)}catch(e){logger.warn("Cannot register onShow callback.")}return t}},{key:"showToast",value:function(e){var t;_.isFunction(this.api.showToast)&&(t={title:e},"dd_mp"!==this._config.platform&&"ali_mp"!==this._config.platform||(t.content=e),this.api.showToast(t))}}],[{key:"createInstance",value:function(){return this._createInstance("wechat_mp")}},{key:"_createInstance",value:function(e){switch(e){case"wechat_mp":return new r(wx,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_wechat"},{mpPlatform:"wechat",mp:!0,platform:e});case"wechat_mg":return new r(wx,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_wechat_game"},{mpPlatform:"wechat",platform:e});case"qq_mp":return new r(qq,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qq"},{mpPlatform:"qq",mp:!0,platform:e});case"qq_mg":return new r(qq,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qq_game"},{mpPlatform:"qq",platform:e});case"baidu_mp":return new r(swan,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_swan"},{mpPlatform:function(e){return e.host},mp:!0,platform:e});case"baidu_mg":return new r(swan,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_swan_game"},{mpPlatform:function(e){return e.host},platform:e});case"taobao_mg":return new r(my,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_taobao_game"},{mpPlatform:"taobao",platform:e});case"tt_mg":return new r(tt,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_tt_game"},{mpPlatform:function(e){return e.appName},platform:e});case"tt_mp":return new r(tt,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_tt"},{mpPlatform:function(e){return e.appName},mp:!0,platform:e});case"ali_mp":return new r(my,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_ali"},{mpPlatform:function(e){return e.app},mp:!0,platform:e});case"ali_mg":return new r(my,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_ali_game"},{mpPlatform:function(e){return e.app},platform:e});case"dd_mp":return new r(dd,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_dd"},{mpPlatform:"dingding",mp:!0,platform:e});case"bl_mg":return new r(bl,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_bl_game"},{mpPlatform:"bilibili",platform:e});case"kuaishou_mp":return new r(ks,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_kuaishou_program"},{mpPlatform:"kuaishou",mp:!0,platform:e});case"kuaishou_mg":return new r(ks,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_kuaishou_game"},{mpPlatform:"kuaishou_game",platform:e});case"qh360_mg":return new r(qh,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qh360"},{mpPlatform:"qh360",platform:e});case"tb_mp":return new r(my,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_tb"},{mpPlatform:"tb",mp:!0,platform:e});case"jd_mp":return new r(jd,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_jd"},{mpPlatform:"jd",mp:!0,platform:e});case"qh360_mp":return new r(qh,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qh360"},{mpPlatform:"qh360",mp:!0,platform:e});case"WEB":return new PlatformProxy.createInstance}}}]),r}(),PlatformAPI=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"_getCurrentPlatform",value:function(){return this.currentPlatform||(this.currentPlatform=PlatformProxy$1.createInstance())}},{key:"getConfig",value:function(){return this._getCurrentPlatform().getConfig()}},{key:"getStorage",value:function(e,t,n){return this._getCurrentPlatform().getStorage(e,t,n)}},{key:"setStorage",value:function(e,t){return this._getCurrentPlatform().setStorage(e,t)}},{key:"removeStorage",value:function(e){return this._getCurrentPlatform().removeStorage(e)}},{key:"getSystemInfo",value:function(e){return this._getCurrentPlatform().getSystemInfo(e)}},{key:"getNetworkType",value:function(e){return this._getCurrentPlatform().getNetworkType(e)}},{key:"getQuickDevice",value:function(e){return this._getCurrentPlatform().getQuickDevice(e)}},{key:"onNetworkStatusChange",value:function(e){this._getCurrentPlatform().onNetworkStatusChange(e)}},{key:"request",value:function(e){return this._getCurrentPlatform().request(e)}},{key:"initAutoTrackInstance",value:function(e,t){return this._getCurrentPlatform().initAutoTrackInstance(e,t)}},{key:"setGlobal",value:function(e,t){e&&t&&this._getCurrentPlatform().setGlobal(e,t)}},{key:"getAppOptions",value:function(e){return this._getCurrentPlatform().getAppOptions(e)}},{key:"showDebugToast",value:function(e){this._getCurrentPlatform().showToast(e)}}]),e}(),_={},ArrayProto=Array.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,nativeToString=ObjProto.toString,nativeHasOwnProperty=Object.prototype.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeIsArray=Array.isArray,breaker={},logger=(_.isNumber=function(e){return"number"==typeof e?0==e-e:"string"==typeof e&&""!==e.trim()&&(Number.isFinite?Number.isFinite(+e):isFinite(+e))},_.each=function(e,t,n){if(null==e)return!1;if(nativeForEach&&e.forEach===nativeForEach)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,i=e.length;r<i;r++)if(r in e&&t.call(n,e[r],r,e)===breaker)return!1}else for(var o in e)if(nativeHasOwnProperty.call(e,o)&&t.call(n,e[o],o,e)===breaker)return!1},_.sleep=function(t){return new Promise(function(e){return setTimeout(e,t)})},_.extend=function(n){return _.each(slice.call(arguments,1),function(e){for(var t in e)void 0!==e[t]&&(n[t]=e[t])}),n},_.extend2Layers=function(n){return _.each(slice.call(arguments,1),function(e){for(var t in e)void 0!==e[t]&&(_.isObject(e[t])&&_.isObject(n[t])?_.extend(n[t],e[t]):n[t]=e[t])}),n},_.isArray=nativeIsArray||function(e){return"[object Array]"===nativeToString.call(e)},_.isFunction=function(e){try{return"function"==typeof e}catch(e){return!1}},_.isPromise=function(e){return"[object Promise]"===nativeToString.call(e)&&null!=e},_.isObject=function(e){return"[object Object]"===nativeToString.call(e)&&null!=e},_.isEmptyObject=function(e){if(_.isObject(e)){for(var t in e)if(nativeHasOwnProperty.call(e,t))return!1;return!0}return!1},_.isUndefined=function(e){return void 0===e},_.isString=function(e){return"[object String]"===nativeToString.call(e)},_.isDate=function(e){return"[object Date]"===nativeToString.call(e)},_.isBoolean=function(e){return"[object Boolean]"===nativeToString.call(e)},_.isNumber=function(e){return"[object Number]"===nativeToString.call(e)&&/[\d\.]+/.test(String(e))},_.isJSONString=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},_.decodeURIComponent=function(t){var n="";try{n=decodeURIComponent(t)}catch(e){n=t}return n},_.encodeURIComponent=function(t){var n="";try{n=encodeURIComponent(t)}catch(e){n=t}return n},_.utf8Encode=function(e){for(var t,n="",r=t=0,i=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,o=0;o<i;o++){var a=e.charCodeAt(o),s=null;a<128?t++:s=127<a&&a<2048?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),null!==s&&(r<t&&(n+=e.substring(r,t)),n+=s,r=t=o+1)}return r<t&&(n+=e.substring(r,e.length)),n},_.base64Encode=function(e){var t,n,r,i,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,s=0,c="",u=[];if(!e)return e;for(e=_.utf8Encode(e);t=(i=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>12&63,n=i>>6&63,r=63&i,u[s++]=o.charAt(i>>18&63)+o.charAt(t)+o.charAt(n)+o.charAt(r),a<e.length;);switch(c=u.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c},_.encodeDates=function(r){return _.each(r,function(e,t){if(_.isDate(e))r[t]=_.formatDate(e);else if(_.isObject(e))r[t]=_.encodeDates(e);else if(_.isArray(e))for(var n=0;n<e.length;n++)_.isDate(e[n])&&(r[t][n]=_.formatDate(e[n]))}),r},_.formatDate=function(e){function t(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+((e=e.getMilliseconds())<100&&9<e?"0"+e:e<10?"00"+e:e)},_.searchObjDate=function(n){try{(_.isObject(n)||_.isArray(n))&&_.each(n,function(e,t){_.isObject(e)||_.isArray(e)?_.searchObjDate(n[t]):_.isDate(e)&&(n[t]=_.formatDate(e))})}catch(e){logger.warn(e)}},_.UUID=function(){var e=(new Date).getTime();return String(Math.random()).replace(".","").slice(1,11)+"-"+e},_.UUIDv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},_.setMpPlatform=function(e){_.mpPlatform=e},_.getMpPlatform=function(){return _.mpPlatform},_.createExtraHeaders=function(){return{"GE-Integration-Type":Config.LIB_NAME,"GE-Integration-Version":Config.LIB_VERSION,"GE-Integration-Count":"1","GE-Integration-Extra":_.getMpPlatform()}},_.checkAppId=function(e){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return"";return e=e.replace(/\s*/g,"")},_.checkUrl=function(e){return e=e.replace(/\s*/g,""),e=_.url("basic",e)},_.url=function(){function i(){return new RegExp(/(.*?)\.?([^.]*?)\.(com|net|org|biz|ws|in|me|co\.uk|co|org\.uk|ltd\.uk|plc\.uk|me\.uk|edu|mil|br\.com|cn\.com|eu\.com|hu\.com|no\.com|qc\.com|sa\.com|se\.com|se\.net|us\.com|uy\.com|ac|co\.ac|gv\.ac|or\.ac|ac\.ac|af|am|as|at|ac\.at|co\.at|gv\.at|or\.at|asn\.au|com\.au|edu\.au|org\.au|net\.au|id\.au|be|ac\.be|adm\.br|adv\.br|am\.br|arq\.br|art\.br|bio\.br|cng\.br|cnt\.br|com\.br|ecn\.br|eng\.br|esp\.br|etc\.br|eti\.br|fm\.br|fot\.br|fst\.br|g12\.br|gov\.br|ind\.br|inf\.br|jor\.br|lel\.br|med\.br|mil\.br|net\.br|nom\.br|ntr\.br|odo\.br|org\.br|ppg\.br|pro\.br|psc\.br|psi\.br|rec\.br|slg\.br|tmp\.br|tur\.br|tv\.br|vet\.br|zlg\.br|br|ab\.ca|bc\.ca|mb\.ca|nb\.ca|nf\.ca|ns\.ca|nt\.ca|on\.ca|pe\.ca|qc\.ca|sk\.ca|yk\.ca|ca|cc|ac\.cn|net\.cn|com\.cn|edu\.cn|gov\.cn|org\.cn|bj\.cn|sh\.cn|tj\.cn|cq\.cn|he\.cn|nm\.cn|ln\.cn|jl\.cn|hl\.cn|js\.cn|zj\.cn|ah\.cn|gd\.cn|gx\.cn|hi\.cn|sc\.cn|gz\.cn|yn\.cn|xz\.cn|sn\.cn|gs\.cn|qh\.cn|nx\.cn|xj\.cn|tw\.cn|hk\.cn|mo\.cn|cn|cx|cz|de|dk|fo|com\.ec|tm\.fr|com\.fr|asso\.fr|presse\.fr|fr|gf|gs|co\.il|net\.il|ac\.il|k12\.il|gov\.il|muni\.il|ac\.in|co\.in|org\.in|ernet\.in|gov\.in|net\.in|res\.in|is|it|ac\.jp|co\.jp|go\.jp|or\.jp|ne\.jp|ac\.kr|co\.kr|go\.kr|ne\.kr|nm\.kr|or\.kr|li|lt|lu|asso\.mc|tm\.mc|com\.mm|org\.mm|net\.mm|edu\.mm|gov\.mm|ms|nl|no|nu|pl|ro|org\.ro|store\.ro|tm\.ro|firm\.ro|www\.ro|arts\.ro|rec\.ro|info\.ro|nom\.ro|nt\.ro|se|si|com\.sg|org\.sg|net\.sg|gov\.sg|sk|st|tf|ac\.th|co\.th|go\.th|mi\.th|net\.th|or\.th|tm|to|com\.tr|edu\.tr|gov\.tr|k12\.tr|net\.tr|org\.tr|com\.tw|org\.tw|net\.tw|ac\.uk|uk\.com|uk\.net|gb\.com|gb\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\.hk|org\.hk|net\.hk|edu\.hk|us|tk|cd|by|ad|lv|eu\.lv|bz|es|jp|cl|ag|mobi|eu|co\.nz|org\.nz|net\.nz|maori\.nz|iwi\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\.pt|edu\.pt|asia|fi|com\.ve|net\.ve|fi|org\.ve|web\.ve|info\.ve|co\.ve|tel|im|gr|ru|net\.ru|org\.ru|hr|com\.hr|ly|xyz)$/)}function o(e,t){var n=e.charAt(0),t=t.split(n);return n===e?t:t[(e=parseInt(e.substring(1),10))<0?t.length+e:e-1]}function a(e,t){for(var n,r=e.charAt(0),i=t.split("&"),o=[],a={},s=e.substring(1),c=0,u=i.length;c<u;c++)if(""!==(o=(o=i[c].match(/(.*?)=(.*)/))||[i[c],i[c],""])[1].replace(/\s/g,"")){if(o[2]=(n=o[2]||"",_.decodeURIComponent(n.replace(/\+/g," "))),s===o[1])return o[2];(n=o[1].match(/(.*)\[([0-9]+)\]/))?(a[n[1]]=a[n[1]]||[],a[n[1]][n[2]]=o[2]):a[o[1]]=o[2]}return r===e?a:a[s]}return function(e,t){var n,r={};if("tld?"===e)return i();if(t=t||window.location.toString(),!e)return t;if(e=e.toString(),t.match(/^mailto:([^/].+)/))n=t.match(/^mailto:([^/].+)/),r.protocol="mailto",r.email=n[1];else{if((t=t.match(/(.*?)\/#!(.*)/)?(n=t.match(/(.*?)\/#!(.*)/))[1]+n[2]:t).match(/(.*?)#(.*)/)&&(n=t.match(/(.*?)#(.*)/),r.hash=n[2],t=n[1]),r.hash&&e.match(/^#/))return a(e,r.hash);if(t.match(/(.*?)\?(.*)/)&&(n=t.match(/(.*?)\?(.*)/),r.query=n[2],t=n[1]),r.query&&e.match(/^\?/))return a(e,r.query);if(t.match(/(.*?):?\/\/(.*)/)&&(n=t.match(/(.*?):?\/\/(.*)/),r.protocol=n[1].toLowerCase(),t=n[2]),t.match(/(.*?)(\/.*)/)&&(n=t.match(/(.*?)(\/.*)/),r.path=n[2],t=n[1]),r.path=(r.path||"").replace(/^([^/])/,"/$1").replace(/\/$/,""),(e=e.match(/^[-0-9]+$/)?e.replace(/^([^/])/,"/$1"):e).match(/^\//))return o(e,r.path.substring(1));if((n=(n=o("/-1",r.path.substring(1)))&&n.match(/(.*?)\.(.*)/))&&(r.file=n[0],r.filename=n[1],r.fileext=n[2]),t.match(/(.*):([0-9]+)$/)&&(n=t.match(/(.*):([0-9]+)$/),r.port=n[2],t=n[1]),t.match(/(.*?)@(.*)/)&&(n=t.match(/(.*?)@(.*)/),r.auth=n[1],t=n[2]),r.auth&&(n=r.auth.match(/(.*):(.*)/),r.user=n?n[1]:r.auth,r.pass=n?n[2]:void 0),r.hostname=t.toLowerCase(),"."===e.charAt(0))return o(e,r.hostname);i()&&(n=r.hostname.match(i()))&&(r.tld=n[3],r.domain=n[2]?n[2]+"."+n[3]:void 0,r.sub=n[1]||void 0);t=r.port?":"+r.port:"";r.protocol=r.protocol||window.location.protocol.replace(":",""),r.port=r.port||("https"===r.protocol?"443":"80"),r.protocol=r.protocol||("443"===r.port?"https":"http"),r.basic=r.protocol+"://"+r.hostname+t}return e in r?r[e]:"{}"===e?r:""}}(),_.createString=function(e){for(var t=e,n=Math.random().toString(36).substr(2);n.length<t;)n+=Math.random().toString(36).substr(2);return n=n.substr(0,e)},_.createAesKey=function(){return _.createString(16)},_.setQuery=function(e){try{if(!_.isObject(e))return"";var t,n=PlatformAPI.getConfig().persistenceNameOld.includes("GravityEngine_ali"),r=[];for(t in e)(n||e.hasOwnProperty(t))&&r.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return r.join("&")}catch(e){return""}},_.generateEncryptyData=function(e,t){if(void 0!==t){var n=t.publicKey,t=t.version;if(void 0!==n&&void 0!==t&&"undefined"!=typeof CryptoJS&&"undefined"!=typeof JSEncrypt){var r=_.createAesKey();try{var i=CryptoJS.enc.Utf8.parse(r),o=CryptoJS.enc.Utf8.parse(JSON.stringify(e)),a=_.isUndefined(CryptoJS.pad.Pkcs7)?CryptoJS.pad.PKCS7:CryptoJS.pad.Pkcs7,s=CryptoJS.AES.encrypt(o,i,{mode:CryptoJS.mode.ECB,padding:a}).toString(),c=new JSEncrypt,u=(c.setPublicKey(n),c.encrypt(r));return!1===u?(logger.warn("私钥加密失败，返回原数据"),e):{pkv:t,ekey:u,payload:s}}catch(e){logger.warn("数据加密失败，返回原数据: "+e)}}}return e},"object"===_typeof(logger)?logger:{}),KEY_NAME_MATCH_REGEX=(logger.info=function(){if("object"===("undefined"==typeof console?"undefined":_typeof(console))&&console.log&&logger.enabled)try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}},logger.warn=function(){if("object"===("undefined"==typeof console?"undefined":_typeof(console))&&console.log&&logger.enabled)try{return console.warn.apply(console,arguments)}catch(e){console.warn(arguments[0])}},logger.tencentSdkLog=function(e){console.log("触发tencentSDK：",e)},/^\$?[a-zA-Z][a-zA-Z0-9_]{0,49}$/),PropertyChecker=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"stripProperties",value:function(e){return _.isObject(e)&&_.each(e,function(e,t){_.isString(e)||_.isNumber(e)||_.isDate(e)||_.isBoolean(e)||_.isArray(e)||_.isObject(e)||logger.warn("Your data -",t,e,"- format does not meet requirements and may not be stored correctly. Attribute values only support String, Number, Date, Boolean, Array, Object")}),e}},{key:"_checkPropertiesKey",value:function(e){var n=!0;return _.each(e,function(e,t){KEY_NAME_MATCH_REGEX.test(t)||(logger.warn("Invalid KEY: "+t),n=!1)}),n}},{key:"event",value:function(e){return!(!_.isString(e)||!KEY_NAME_MATCH_REGEX.test(e))||(logger.warn("Check the parameter format. The eventName must start with an English letter and contain no more than 50 characters including letters, digits, and underscores: "+e),!1)}},{key:"propertyName",value:function(e){return!(!_.isString(e)||!KEY_NAME_MATCH_REGEX.test(e))||(logger.warn("Check the parameter format. PropertyName must start with a letter and contain letters, digits, and underscores (_). The value is a string of no more than 50 characters: "+e),!1)}},{key:"properties",value:function(e){return this.stripProperties(e),!(e&&(_.isObject(e)?!this._checkPropertiesKey(e)&&(logger.warn("Check the parameter format. The properties key must start with a letter, contain digits, letters, and underscores (_), and contain a maximum of 50 characters"),1):(logger.warn("properties can be none, but it must be an object"),1)))}},{key:"propertiesMust",value:function(e){return this.stripProperties(e),void 0===e||!_.isObject(e)||_.isEmptyObject(e)?(logger.warn("properties must be an object with a value"),!1):!!this._checkPropertiesKey(e)||(logger.warn("Check the parameter format. The properties key must start with a letter, contain digits, letters, and underscores (_), and contain a maximum of 50 characters"),!1)}},{key:"userId",value:function(e){return!(!_.isString(e)||!/^.{1,64}$/.test(e))||(logger.warn("The user ID must be a string of less than 64 characters and cannot be null"),!1)}},{key:"userAddProperties",value:function(e){if(!this.propertiesMust(e))return!1;for(var t in e)if(!_.isNumber(e[t]))return logger.warn("The attributes of userAdd need to be Number"),!1;return!0}},{key:"userAppendProperties",value:function(e){if(!this.propertiesMust(e))return!1;for(var t in e)if(!_.isArray(e[t]))return logger.warn("The attribute of userAppend must be Array"),!1;return!0}}]),e}();function t(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function e(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}()||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){var n;if(e)return"string"==typeof e?r(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}function i(e,t){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function a(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=s(n);return u(this,r?(e=s(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function u(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e){return(l="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return _typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof(e)})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,p(r.key),r)}}function v(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e){e=function(e){if("object"!==l(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==l(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===l(e)?e:String(e)}var h,y,_$1="LOCAL_ID",g="QUEUE_ACTIONS",m="CLICK_ID",A="QUEUE_LOST_MAP",R="REMOTE_CONFIG",k="REMOTE_COMMON_CONFIG",T="OPENID",S={init:"init",reporting:"reporting",fail:"fail"},E={maxSdkInstance:4,maxQueueLength:500,actionParamMaxLength:1e4,autoTrack:!0,reportThreshold:5,reportDelay:1,inspectDelay:30,cgiBatchSize:50,requestConcurrency:4,requestTimeout:1e4,signVersion:"1.0",realTimeActionList:["START_APP","REGISTER","PURCHASE"]},b={JS_RUN_ERROR:"JS_RUN_ERROR",REQUEST_ERROR:"REQUEST_ERROR",REQUEST_CONFIG_ERROR:"REQUEST_CONFIG_ERROR",JS_QUEUE_LOG:"JS_QUEUE_LOG",PROXY_ERROR:"PROXY_ERROR",PROXY_POLYFILL:"PROXY_POLYFILL",QUEUE_LOST_NUM:"QUEUE_LOST_NUM",REQ_TOTAL:"REQ_TOTAL",SIGN_ERROR:"SIGN_ERROR"},O="ANDROID",I="IOS",w="WINDOWS",C="OSX",x="UNKNOWN",N=1e3,L=100,P=10,M="START_APP",D="ENTER_FOREGROUND",U="ENTER_BACKGROUND",q="ADD_TO_WISHLIST",j="PURCHASE",F="APP_QUIT",B="REGISTER",V="CREATE_ROLE",K="TUTORIAL_FINISH",G="TRUE",Q="FALSE",Y="TENCENT",W="BYTEDANCE",J="KUAISHOU",H="ALIBABA",z="BAIDU",$="OTHERS",X="UNKNOWN",Z="TICKET_INTERVAL_CHANGE",tt$1=(y=function(e){return"".concat("@dn-sdk/minigame","_").concat("production","_").concat(e)},{getSync:function(e){var t;try{t=wx.getStorageSync(y(e))}catch(e){console.error("storage get error",e)}return t},setSync:function(e,t){try{wx.setStorageSync(y(e),t)}catch(e){return console.error("storage set error",e),!1}return!0}}),et=function(){if(h)return h;try{return h=wx.getSystemInfoSync()}catch(e){return{}}},nt=function(){var r;return function(){var e,t,n;return r||(t=(e=et()).system,t=(null==(t=void 0===t?"":t)?void 0:t.split(" "))||[],n=(n=t[0])?-1<(n=(null==n?void 0:n.toUpperCase())||"").indexOf("ANDROID")?O:-1<n.indexOf("IOS")?I:-1<n.indexOf("MAC")?C:-1<n.indexOf("WINDOWS")?w:x:x,t=!(t=t)||t.length<=0?"":2===t.length?t[1]:3===t.length&&"Windows"===t[0]?"".concat(t[1]," ").concat(t[2]):t[t.length-1],r={benchmark_level:e.benchmarkLevel,device_brand:e.brand,screen_height:Math.floor(e.screenHeight),screen_width:Math.floor(e.screenWidth),wx_lib_version:e.SDKVersion,wx_version:e.version,wx_platform:e.platform,device_model:e.model,os:n,os_version:t}),r}}(),rt=function(){var e;return function(){try{if(e)return e;(e=e||tt$1.getSync(_$1)||"")||(e=mt(),tt$1.setSync(_$1,e))}catch(e){}return e}}(),ot=function(){var t="unknown",e=!1;return function(){if(!e)try{wx.getNetworkType({success:function(e){t=e.networkType},fail:function(){t="unknown"}}),wx.onNetworkStatusChange(function(e){t=e.networkType}),e=!0}catch(e){}return t}}(),it=(ot(),function(){var e="";return function(){return e=e||tt$1.getSync(T)||""}}()),at=function(){var t;return function(){if(t)return t;try{var e=wx.getAccountInfoSync();return ht(e.miniProgram)?t=e.miniProgram:{}}catch(e){return{}}}}();function ut(e){var t,n=null==e?void 0:e.query;return ht(n)?(t="",n.gdt_vid||-1<[1045,1046,1084].indexOf(null==e?void 0:e.scene)?t=Y:n.clue_token||n.clickid&&n.item_id?t=W:n.callback&&"kuaishou"===n.ksChannel?t=J:n.bd_vid||n.ai&&n.d&&n.q&&n.c?t=z:n.uctrackid?t=H:(n.trackid||n.imp||-1<[1065,1069,1194].indexOf(null==e?void 0:e.scene)&&(n.callback||n.u))&&(t=$),t):""}function ct(e,t){try{var n=nt(),r={sdk_version:"1.5.4",sdk_name:"@dn-sdk/minigame",device_brand:null==n?void 0:n.device_brand,device_model:null==n?void 0:n.device_model,wx_version:null==n?void 0:n.wx_version,wx_lib_version:null==n?void 0:n.wx_lib_version,wx_platform:null==n?void 0:n.wx_platform,os:null==n?void 0:n.os,os_version:null==n?void 0:n.os_version,local_id:rt()},i=Object.assign(r,e);wx.request({url:"https://api.datanexus.qq.com/data-nexus-trace/log",data:i,method:"POST",timeout:E.requestTimeout,success:function(e){"function"==typeof t&&200===(null==e?void 0:e.statusCode)&&t()}})}catch(n){xt.error(n)}}var st=function(){function e(){f(this,e)}return v(e,null,[{key:"revise",value:function(e){0<e&&!this.isRevised&&(this.offsetTime=e-Date.now(),this.isRevised=!0)}},{key:"getRevisedcurrentTimeMillis",value:function(){return this.isRevised?Date.now()+this.offsetTime:-1}}]),e}();function lt(e){return new Promise(function(t,n){wx.request({method:"POST",url:"https://api.datanexus.qq.com/data-nexus-config/v1/sdk/config/get",data:e,timeout:E.requestTimeout,success:function(e){ft(e,t,"config/get",n),vt(e)},fail:function(e){dt(e,"config/get",n)}})})}function ft(e,t,n,r){var i,o=null==e?void 0:e.statusCode,a=null==(a=null==e?void 0:e.data)?void 0:a.code;200!==o||0!==a?(i=200!==o?"number"==typeof o?-1*o:-888:a,ct({log_type:b.REQUEST_CONFIG_ERROR,message:"cgiName: ".concat(n,", statusCode: ").concat(o,", code: ").concat(a,", traceid: ").concat(null==(n=null==e?void 0:e.data)?void 0:n.trace_id),code:i}),null!=r&&r(null==(o=null==e?void 0:e.data)?void 0:o.data)):t(null==(a=e.data)?void 0:a.data)}function dt(e,t,n){ct({log_type:b.REQUEST_CONFIG_ERROR,message:"cgiName: ".concat(t," , message: ").concat(null==e?void 0:e.errMsg," "),code:"number"==typeof(null==e?void 0:e.errno)?-1*e.errno:-999}),null!=n&&n(e)}function vt(e){e=+(null==(e=null==e?void 0:e.header)?void 0:e["Server-Time"]);17266752e5<e&&st.revise(e)}st.offsetTime=0,st.isRevised=!1;var pt=Object.prototype.toString,ht=function(e){return"[object Object]"===pt.call(e)},yt=function(e){return"[object Array]"===pt.call(e)},_t=function(e){return"[object Function]"===pt.call(e)},gt=(new Date).getTime();function mt(){var n=(new Date).getTime(),r=Math.abs(1e3*(n-gt));return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random();return 0<n?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(r+t)%16|0,r=Math.floor(r/16)),("x"===e?t:3&t|8).toString(16).replace(/-/g,"")})}var At=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Rt=function(e){if("string"!=typeof e)throw new TypeError("Invalid argument expected string");if(!At.test(e))throw new Error("Invalid argument not valid semver ('".concat(e,"' received)"))},kt=function(e){return isNaN(Number(e))?e:Number(e)},Tt=function(e){var e=e.replace(/^v/,"").replace(/\+.*$/,""),t=-1===(t=e).indexOf("-")?t.length:t.indexOf("-"),n=e.substring(0,t).split(".");return n.push(e.substring(t+1)),n},St=function(e,t){[e,t].forEach(Rt);for(var n=Tt(e),r=Tt(t),i=0;i<Math.max(n.length-1,r.length-1);i++){var o=parseInt(n[i]||"0",10),a=parseInt(r[i]||"0",10);if(a<o)return 1;if(o<a)return-1}e=n[n.length-1],t=r[r.length-1];if(e&&t)for(var s=e.split(".").map(kt),c=t.split(".").map(kt),u=0;u<Math.max(s.length,c.length);u++){if(void 0===s[u]||"string"==typeof c[u]&&"number"==typeof s[u])return-1;if(void 0===c[u]||"string"==typeof s[u]&&"number"==typeof c[u]||s[u]>c[u])return 1;if(c[u]>s[u])return-1}else if(e||t)return e?-1:1;return 0},Et=function(e){{if(ht(e)){var t,n=["user_action_set_id","secret_key","appid","openid","unionid","user_unique_id","auto_track","auto_attr"];for(t in e)n.includes(t)||xt.warn("Invalid property '".concat(t,"' found in config"));return"number"!=typeof e.user_action_set_id?"user_action_set_id 参数需为 number 类型":e.user_action_set_id<=0?"user_action_set_id 参数需大于 0":"string"!=typeof e.secret_key?"secret_key 参数需为 string 类型":""===e.secret_key.trim()?"缺少 secret_key 参数":32!==e.secret_key.length?"secret_key 参数需为 32 位字符串":"string"!=typeof e.appid?"appid 参数需为 string 类型":""!==e.appid.trim()||"缺少 appid"}return"初始化参数需为 object 类型"}};function bt(e){return Ot()[e]}function Ot(){return E}function It(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var wt=function(t){try{return t&&"string"==typeof t?-1===(t=t.replace(/\s/g,"")).indexOf(".")?t:t.split(".").slice(0,2).join("."):""}catch(e){return t}},Ct=function(){function o(){f(this,o)}return v(o,null,[{key:"error",value:function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=console).error.apply(t,["".concat("[@dn-sdk/minigame v1.5.4]",": ").concat(e)].concat(r))}},{key:"info",value:function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];o.debug&&(t=console).info.apply(t,["".concat("[@dn-sdk/minigame v1.5.4]",": ").concat(e)].concat(r))}},{key:"log",value:function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];o.debug&&(t=console).log.apply(t,["".concat("[@dn-sdk/minigame v1.5.4]",": ").concat(e)].concat(r))}},{key:"warn",value:function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=console).warn.apply(t,["".concat("[@dn-sdk/minigame v1.5.4]",": ").concat(e)].concat(r))}},{key:"devLog",value:function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];o.isDev&&(t=console).log.apply(t,["".concat("[@dn-sdk/minigame v1.5.4]",": ").concat(e)].concat(r))}}]),o}(),xt=Ct,Nt=(xt.debug=!1,xt.isDev=!1,function(){var r;return function(){if(!r)try{var e=wx.getLaunchOptionsSync(),t=e.query.gdt_vid||"",n=(t?tt$1.setSync(m,t):t=tt$1.getSync(m)||"",JSON.stringify(e));1e4<n.length&&(n=JSON.stringify({cut:1,scene:e.scene})),r={source_scene:e.scene,pkg_channel_id:e.query.wxgamepro||"",ad_trace_id:t,launch_options:n,channel:ut(e)}}catch(e){r={},xt.log("获取场景值和渠道号失败",e)}return r}}());function Lt(i,o,e){var a=e.value;return e.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];try{return a.apply(this,t)}catch(e){try{xt.error.apply(xt,["calling ".concat(i.constructor.name,".").concat(o," error with arguments")].concat(t)),xt.error(e);var r={log_type:b.JS_RUN_ERROR,message:"[safeExcutable] ".concat(i.constructor.name,".").concat(o,": ").concat(null==e?void 0:e.message),err_stack:null==e?void 0:e.stack};_t(this.reportLog)?this.reportLog(r):ct(r)}catch(r){}}},e}var Pt=function(e,t,n){var r=n.value;return n.value=function(){if(this.inited){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.apply(this,t)}xt.error("上报失败，请先完成初始化")},n},Mt=Object.defineProperty,Dt=Object.getOwnPropertyDescriptor,Ut=function(e,t,n,r){for(var i,o=1<r?void 0:r?Dt(t,n):t,a=e.length-1;0<=a;a--)(i=e[a])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&Mt(t,n,o),o},qt=function(){function n(e){var t=e.userActionSetId,e=e.maxLength,e=void 0===e?500:e;f(this,n),this.lostActionMaps={},this.stack=[],this.localStorageKey="",this.localStorageKey="".concat(g,"_").concat(null==t?void 0:t.toString()),this.maxLength=e,this.userActionSetId=t,this.setTimeStamp(),this.init()}return v(n,[{key:"getItems",value:function(){return this.stack}},{key:"getStorage",value:function(){var e=(null==tt$1?void 0:tt$1.getSync(this.localStorageKey))||"[]";return JSON.parse(e)}},{key:"reportLostNum",value:function(){var e,i=this,t=Object.assign({},this.lostActionMaps),n=[];for(e in t){var r=null==e?void 0:e.split("_");n.push({queue_lost_session_id:r[0],queue_lost_timestamp:r[1],queue_lost_num:t[e]})}n.length&&(this.setTimeStamp(),n.forEach(function(e){var t=Object.assign({},{user_action_set_id:i.userActionSetId,log_type:b.QUEUE_LOST_NUM},e),n=null==e?void 0:e.queue_lost_session_id,e=null==e?void 0:e.queue_lost_timestamp,r="".concat(n,"_").concat(e);ct(t,function(){It(i.lostActionMaps,r)&&(delete i.lostActionMaps[r],tt$1.setSync(A,JSON.stringify(i.lostActionMaps)))})}))}},{key:"getLostMaps",value:function(){return this.lostActionMaps}},{key:"init",value:function(){var e=this,t=this.getStorage(),t=null==t?void 0:t.map(function(e){return e.inner_status===(null==S?void 0:S.reporting)?Object.assign({},e,{inner_status:null==S?void 0:S.fail,is_retry:!0,retry_count:e.retry_count+1}):e});this.stack=t,this.lostActionMaps=JSON.parse(tt$1.getSync(A)||"{}"),setTimeout(function(){e.reportLostNum()},1e3)}},{key:"addItem",value:function(e){var t;null!=(t=null==this?void 0:this.stack)&&t.push(e)}},{key:"removeItems",value:function(t){var e=null==(e=null==this?void 0:this.stack)?void 0:e.filter(function(e){return!(null!=t&&t.includes(null==e?void 0:e.action_id))});this.stack=e}},{key:"updateForReportFail",value:function(t){var e;this.stack=null==(e=this.stack)?void 0:e.map(function(e){return null!=t&&t.includes(null==e?void 0:e.action_id)?Object.assign({},e,{inner_status:null==S?void 0:S.fail,retry_count:e.retry_count+1,is_retry:!0}):e})}},{key:"updateForReporting",value:function(t){var e;this.stack=null==(e=this.stack)?void 0:e.map(function(e){return null!=t&&t.includes(null==e?void 0:e.action_id)?Object.assign({},e,{inner_status:null==S?void 0:S.reporting}):e})}},{key:"updateAllStack",value:function(e){this.stack=e}},{key:"updateToStorage",value:function(){tt$1.setSync(this.localStorageKey,JSON.stringify(this.stack))}},{key:"updateLostAction",value:function(e){var t;e&&(e="".concat(e,"_").concat(this.timeStamp),t=this.lostActionMaps[e]||0,this.lostActionMaps[e]=t+1,tt$1.setSync(A,JSON.stringify(this.lostActionMaps)))}},{key:"setTimeStamp",value:function(){this.timeStamp=Date.now().toString()}}]),n}(),jt=(Ut([Lt],qt.prototype,"getItems",1),Ut([Lt],qt.prototype,"getStorage",1),Ut([Lt],qt.prototype,"reportLostNum",1),Ut([Lt],qt.prototype,"getLostMaps",1),Ut([Lt],qt.prototype,"init",1),Ut([Lt],qt.prototype,"addItem",1),Ut([Lt],qt.prototype,"removeItems",1),Ut([Lt],qt.prototype,"updateForReportFail",1),Ut([Lt],qt.prototype,"updateForReporting",1),Ut([Lt],qt.prototype,"updateAllStack",1),Ut([Lt],qt.prototype,"updateToStorage",1),Ut([Lt],qt.prototype,"updateLostAction",1),Object.defineProperty),Ft=Object.getOwnPropertyDescriptor,Bt=function(e,t,n,r){for(var i,o=1<r?void 0:r?Ft(t,n):t,a=e.length-1;0<=a;a--)(i=e[a])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&jt(t,n,o),o},Vt=function(){o(i,qt);var r=a(i);function i(e){var t=e.userActionSetId,n=e.maxLength,n=void 0===n?500:n,e=e.ogEvents,e=void 0===e?[]:e;return f(this,i),(t=r.call(this,{userActionSetId:t,maxLength:n})).ogEvents=e,t}return v(i,[{key:"getReportableActions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100,e=this.getItems(),n=[];return null!=e&&e.forEach(function(e){(null==n?void 0:n.length)<t&&(null==e?void 0:e.inner_status)!==(null==S?void 0:S.reporting)&&null!=n&&n.push(e)}),n}},{key:"addAction",value:function(e){var t,n=this.getItems();(null==n?void 0:n.length)>=this.maxLength?(t="队列长度超过最大限制".concat(this.maxLength,"条，SDK将按照行为优先级排序，丢弃优先级最低的行为事件"),xt.warn(t),ct({user_action_set_id:this.userActionSetId,log_type:b.JS_QUEUE_LOG,message:t}),t=this.sortQueue(e,n),xt.debug&&xt.info("超过".concat(this.maxLength,"条按优先级排序的队列："),t.concat([])),n=t.pop(),this.updateAllStack(t),this.updateLostAction((null==n?void 0:n.session_id)||"")):this.addItem(e),this.updateToStorage()}},{key:"removeActions",value:function(e){this.removeItems(e),this.updateToStorage()}},{key:"updateActionsForReportFail",value:function(e){this.updateForReportFail(e),this.updateToStorage()}},{key:"updateActionsForReporting",value:function(e){this.updateForReporting(e),this.updateToStorage()}},{key:"getReportableActionsLength",value:function(){var e=this.getItems().filter(function(e){return(null==e?void 0:e.inner_status)!==(null==S?void 0:S.reporting)});return null==e?void 0:e.length}},{key:"sortQueue",value:function(e,t){function n(e){return i[e.action_id]||(i[e.action_id]=r.caculateWeight(o,e)),i[e.action_id]}var r=this,i={},o=null==e?void 0:e.action_time,t=t.concat([e]);return t.sort(function(e,t){return n(t)-n(e)})}},{key:"caculateWeight",value:function(e,t){var n=0,r=this.formatWeight(e,null==t?void 0:t.action_time),i=r.ogWeight,o=r.sdkWeight,r=r.userWeight,a=(null!=(a=this.ogEvents)&&a.includes(null==t?void 0:t.action_type)&&(n+=i),null!=t&&t.is_sdk_auto_track?n+=o:n+=r,e-(null==t?void 0:t.action_time)+1);return 0<a?n+1/a:n}},{key:"formatWeight",value:function(e,t){var n=N,r=P,i=L;return 2592e6<e-t&&(n/=100,r/=100,i/=100),{ogWeight:n,sdkWeight:r,userWeight:i}}}]),i}(),Kt=(Bt([Lt],Vt.prototype,"getReportableActions",1),Bt([Lt],Vt.prototype,"addAction",1),Bt([Lt],Vt.prototype,"removeActions",1),Bt([Lt],Vt.prototype,"updateActionsForReportFail",1),Bt([Lt],Vt.prototype,"updateActionsForReporting",1),Bt([Lt],Vt.prototype,"getReportableActionsLength",1),Bt([Lt],Vt.prototype,"sortQueue",1),Bt([Lt],Vt.prototype,"caculateWeight",1),Bt([Lt],Vt.prototype,"formatWeight",1),function(){function n(){f(this,n),this.events={}}return v(n,[{key:"subscribe",value:function(e,t){n.checkCallback(t),yt(this.events[e])?this.events[e].push(t):this.events[e]=[t]}},{key:"once",value:function(e,t){n.checkCallback(t),this.subscribe(this.onceEventName(e),t)}},{key:"unsubscribe",value:function(e,t){n.checkCallback(t),yt(this.events[e])&&(this.events[e]=this.events[e].filter(function(e){return e!==t})),yt(this.events[this.onceEventName(e)])&&(this.events[this.onceEventName(e)]=this.events[this.onceEventName(e)].filter(function(e){return e!==t}))}},{key:"publish",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=Date.now();yt(this.events[e])&&this.events[e].forEach(function(e){return e.apply(void 0,[i].concat(n))}),yt(this.events[this.onceEventName(e)])&&(this.events[this.onceEventName(e)].forEach(function(e){return e.apply(void 0,[i].concat(n))}),this.events[this.onceEventName(e)]=[])}},{key:"onceEventName",value:function(e){return"once_event_prefix_".concat(e)}}],[{key:"checkCallback",value:function(e){_t(e)||xt.error(n.ERROR_CALLBACK_IS_NOT_A_FUNCTION)}}]),n}()),Gt=Kt,Qt=(Gt.ERROR_CALLBACK_IS_NOT_A_FUNCTION="callback 不是函数",new Gt),Yt=["REGISTER","VIEW_CONTENT","ADD_TO_CART","PURCHASE","COMPLETE_ORDER","ADD_TO_WISHLIST","START_APP","CREATE_ROLE","AUTHORIZE","TUTORIAL_FINISH","START_PAY","FINISH_PAY"],Wt="START_APP",Jt="TICKET",Ht="ENTER_FOREGROUND",zt="ENTER_BACKGROUND",$t="LOGIN",Xt="SHARE",Zt="TAP_GAME_CLUB",te="CREATE_GAME_CLUB",ee="CREATE_GAME_ROOM",ne="JOIN_GAME_ROOM",re="FINISH_PAY",oe="START_PAY",ie="ADD_TO_WISHLIST",ae=["REGISTER","START_APP","RE_ACTIVE"],ue=["TICKET","ENTER_FOREGROUND","ENTER_BACKGROUND"],ce=function(){function e(){f(this,e),this.channelClaimActionList=ae,this.noClaimActionList=ue,this.realTimeActionList=E.realTimeActionList,this.ticketInterval=60,this.requestTimeout=E.requestTimeout,this.loadConfig()}return v(e,[{key:"getChannelClaimActionList",value:function(){return this.channelClaimActionList}},{key:"getNoClaimActionList",value:function(){return this.noClaimActionList}},{key:"getRealTimeActionList",value:function(){return this.realTimeActionList}},{key:"getTicketInterval",value:function(){return this.ticketInterval}},{key:"getRequestTimeout",value:function(){return this.requestTimeout}},{key:"loadConfig",value:function(){var e,t=this;try{"undefined"!=typeof wx&&((e=tt$1.getSync(k))&&this.updateConfig(e),lt({conf_name:"mini_game_sdk_common",conf_key:"config"}).then(function(e){e&&ht(e)&&(t.updateConfig(e),tt$1.setSync(k,e))}))}catch(e){console.error(e)}}},{key:"updateConfig",value:function(e){e.channelClaimActionList&&yt(e.channelClaimActionList)&&(this.channelClaimActionList=e.channelClaimActionList),e.noClaimActionList&&yt(e.noClaimActionList)&&(this.noClaimActionList=e.noClaimActionList),e.realTimeActionList&&yt(e.realTimeActionList)&&(this.realTimeActionList=e.realTimeActionList),e.ticketInterval&&"number"==typeof e.ticketInterval&&1<e.ticketInterval&&e.ticketInterval!==this.ticketInterval&&(this.ticketInterval=e.ticketInterval,Qt.publish(Z)),e.requestTimeout&&"number"==typeof e.requestTimeout&&5e3<e.requestTimeout&&(this.requestTimeout=e.requestTimeout)}}]),e}(),se=new ce,le=Wt,fe=Jt,de=Ht,ve=zt,pe=function(){var r=!1,i=!1,o=!0,a=!0,s=!0,c=!1;return function(){var e,t,n;c||(c=!0,(null==(e=tt$1.getSync(R))?void 0:e.bg)===G?r=!0:(null==e?void 0:e.bg)===Q&&(r=!1),(null==e?void 0:e.fg)===G?i=!0:(null==e?void 0:e.fg)===Q&&(i=!1),(null==e?void 0:e.st)===G?o=!0:(null==e?void 0:e.st)===Q&&(o=!1),(null==e?void 0:e.ti)===G?a=!0:(null==e?void 0:e.ti)===Q&&(a=!1),xt.devLog("当前缓存开关 bgOn，fgOn，stOn，tiOn：",r,i,o,a),o&&Qt.publish(le),a&&(t=function(){s&&Qt.publish(fe)},n=setInterval(t,1e3*se.getTicketInterval()),Qt.subscribe(Z,function(){n&&clearInterval(n),n=setInterval(t,1e3*se.getTicketInterval())})),wx.onShow(function(e){if(s=!0,i){var t="";try{1e4<(t=JSON.stringify(e)).length&&(t=JSON.stringify({cut:1,scene:e.scene}))}catch(e){}Qt.publish(de,{enter_options:t})}}),wx.onHide(function(){s=!1,r&&Qt.publish(ve)}))}}(),he="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ye(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _e,ge=ye(function(){var g=null;function _(e){return e&&("object"==l(e)||"function"==typeof e)}function m(e){if(null!==e&&!_(e))throw new TypeError("Object prototype may only be an Object or null: "+e)}function v(){return null}var y,k=Object,b=!(!k.create&&{__proto__:null}instanceof k),S=k.create||(b?function(e){return m(e),{__proto__:e}}:function(e){if(m(e),null===e)throw new SyntaxError("Native Object.create is required to create objects with null prototype");function t(){}return t.prototype=e,new t}),w=k.getPrototypeOf||([].__proto__===Array.prototype?function(e){e=e.__proto__;return _(e)?e:null}:v);return(y=function(n,r){if(void 0===(this&&this instanceof y?this.constructor:void 0))throw new TypeError("Constructor Proxy requires 'new'");if(!_(n)||!_(r))throw new TypeError("Cannot create proxy with a non-object as target or handler");var e,i=function(){},t=(g=function(){n=null,i=function(e){throw new TypeError("Cannot perform '".concat(e,"' on a proxy that has been revoked"))}},setTimeout(function(){g=null},0),r);for(e in r={get:null,set:null,apply:null,construct:null},t){if(!(e in r))throw new TypeError("Proxy polyfill does not support trap '".concat(e,"'"));r[e]=t[e]}"function"==typeof t&&(r.apply=t.apply.bind(t));var o,a,s=w(n),c=!1,u=!1,l=("function"==typeof n?(o=function(){var e=this&&this.constructor===o,t=Array.prototype.slice.call(arguments);return i(e?"construct":"apply"),e&&r.construct?r.construct.call(this,n,t):!e&&r.apply?r.apply(n,this,t):e?(t.unshift(n),new(n.bind.apply(n,t))):n.apply(this,t)},c=!0):n instanceof Array?(o=[],u=!0):o=b||null!==s?S(s):{},r.get?function(e){return i("get"),r.get(this,e,o)}:function(e){return i("get"),this[e]}),p=r.set?function(e,t){i("set"),r.set(this,e,t,o)}:function(e,t){i("set"),this[e]=t},f=k.getOwnPropertyNames(n),d={},f=(f.forEach(function(e){var t;(c||u)&&e in o||(t={enumerable:!!k.getOwnPropertyDescriptor(n,e).enumerable,get:l.bind(n,e),set:p.bind(n,e)},k.defineProperty(o,e,t),d[e]=!0)}),!0);if((c||u)&&(a=k.setPrototypeOf||([].__proto__===Array.prototype?function(e,t){return m(t),e.__proto__=t,e}:v),s&&a(o,s)||(f=!1)),r.get||!f)for(var h in n)d[h]||k.defineProperty(o,h,{get:l.bind(n,h)});return k.seal(n),k.seal(o),o}).revocable=function(e,t){return{proxy:new y(e,t),revoke:g}},y}),me={};try{_e=_e||ge()}catch(h){Se(h)}function Ae(t,n,a,i){try{_e&&null!=t&&t[n]&&(t[n]=new _e(t[n],{apply:function(t,n,o){i&&Te(function(){return i.apply(void 0,e(o))});var r=!!(null!=(r=o[0])&&r.success||null!=(r=o[0])&&r.fail),t=(r&&["success","fail"].forEach(function(i){if(o[0][i])try{o[0][i]=new _e(o[0][i],{apply:function(t,n,r){return Te(function(){return a.apply(void 0,[i,o[0]].concat(e(r)))}),t.apply(n,r)}})}catch(i){Se(i)}}),t.apply(n,o));return!r&&t&&"[object Promise]"===Object.prototype.toString.call(t)?t.then(function(e){return Te(function(){return a("success",o[0],e)}),e}).catch(function(e){throw Te(function(){return a("fail",o[0],e)}),e}):t}}))}catch(t){Se(t)}}function Re(t,n,a){try{_e&&null!=t&&t[n]&&(t[n]=new _e(t[n],{apply:function(t,n,r){var i="function"==typeof r[0];if(i)try{r[0]=new _e(r[0],{apply:function(t,n,r){var i=t.call.apply(t,[n].concat(e(r)));return Te(function(){return a(i)}),i}})}catch(t){Se(t)}var o=t.call.apply(t,[n].concat(e(r)));return i||Te(function(){return a(o)}),o}}))}catch(t){Se(t)}}function ke(t){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",a=2<arguments.length?arguments[2]:void 0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],c=4<arguments.length?arguments[4]:void 0;try{_e&&null!=t&&t[o]&&(t[o]=new _e(t[o],{apply:function(t,n,r){var i=t.call.apply(t,[n].concat(e(r)));return a&&me[o]||(Te(function(){return null==c?void 0:c(i)}),s.forEach(function(e){var t=e.eventName,n=e.isAsync,e=e.proxyEvent;(n?Ae:Re)(i,t,e)})),a&&(me[o]=!0),i}}))}catch(t){Se(t)}}function Te(e){try{e()}catch(e){Se(e)}}function Se(e){ct({log_type:b.PROXY_ERROR,message:null==e?void 0:e.message,err_stack:null==e?void 0:e.stack})}var Ee=$t,be=ie,Oe=Xt,Ie=Zt,we=te,Ce=ne,xe=oe,Ne=re,Le=function(){var e=!1;return function(){e||(e=!0,Ae(wx,"login",function(e){"success"===e&&Qt.publish(Ee)}),Re(wx,"onAddToFavorites",function(){Qt.publish(be)}),Re(wx,"onShareTimeline",function(){Qt.publish(Oe,{target:"TIME_LINE",trigger:"MENU"})}),Re(wx,"onShareAppMessage",function(){Qt.publish(Oe,{target:"APP_MESSAGE",trigger:"MENU"})}),Re(wx,"shareAppMessage",function(){Qt.publish(Oe,{target:"APP_MESSAGE",trigger:"BUTTON"})}),ke(wx,"createGameClubButton",!1,[{isAsync:!1,eventName:"onTap",proxyEvent:function(){Qt.publish(Ie)}}],function(){Qt.publish(we)}),ke(wx,"getGameServerManager",!0,[{isAsync:!0,eventName:"createRoom",proxyEvent:function(e){"success"===e&&Qt.publish("CREATE_GAME_ROOM")}},{isAsync:!0,eventName:"joinRoom",proxyEvent:function(e){"success"===e&&Qt.publish(Ce)}}]),Ae(wx,"requestMidasPayment",function(e,t){Qt.publish(Ne,{status:"success"===e?"SUCCESS":"FAIL",quantity:(null==t?void 0:t.buyQuantity)||0,mode:(null==t?void 0:t.mode)||"",platform:(null==t?void 0:t.platform)||"",no:(null==t?void 0:t.outTradeNo)||"",payType:"Midas"})},function(e){Qt.publish(xe,{quantity:(null==e?void 0:e.buyQuantity)||0,mode:(null==e?void 0:e.mode)||"",platform:(null==e?void 0:e.platform)||"",no:(null==e?void 0:e.outTradeNo)||"",payType:"Midas"})}),Ae(wx,"requestMidasPaymentGameItem",function(e,t){t=(t||{}).signData;Qt.publish(Ne,{status:"success"===e?"SUCCESS":"FAIL",quantity:(null==t?void 0:t.buyQuantity)||0,mode:(null==t?void 0:t.mode)||"",platform:(null==t?void 0:t.platform)||"",no:(null==t?void 0:t.outTradeNo)||"",p:(null==t?void 0:t.goodsPrice)||0,productId:(null==t?void 0:t.productId)||"",payType:"MidasGameItem"})},function(e){e=(e||{}).signData;Qt.publish(xe,{quantity:(null==e?void 0:e.buyQuantity)||0,mode:(null==e?void 0:e.mode)||"",platform:(null==e?void 0:e.platform)||"",no:(null==e?void 0:e.outTradeNo)||"",p:(null==e?void 0:e.goodsPrice)||0,productId:(null==e?void 0:e.productId)||"",payType:"MidasGameItem"})}))}}(),Pe=function(){function e(){f(this,e)}return v(e,null,[{key:"isEmpty",value:function(e){return!e||""===e.trim()}},{key:"format",value:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.replace(/\${(\d+)}/g,function(e,t){return n[t]})}},{key:"customStringify",value:function(e){var n=[];try{return JSON.stringify(e,function(e,t){if(void 0===t)return"undefined";if("object"==l(t)&&null!==t){if(-1!==n.indexOf(t))return"[Circular]";n.push(t)}return"bigint"==typeof t?t.toString():t})}catch(e){return"[Param Error]"}}}]),e}(),Me=/^([a-zA-Z][a-zA-Z\d_]{0,63})$/i,De=/^ams_reserved_(.*)/i,Ue=function(){function i(){f(this,i)}return v(i,null,[{key:"validateActionType",value:function(e){return Pe.isEmpty(e)?(xt.error(i.ERROR_ACTION_TYPE_NULL),!1):!!Me.test(e)||(xt.error(i.ERROR_ACTION_TYPE_INVALID),!1)}},{key:"validateActionParam",value:function(e){if(e){if(!ht(e))return xt.error(i.ERROR_ACTION_PARAM_IS_NOT_OBJECT),!1;for(var t in e){if(Pe.isEmpty(t))return xt.error(i.ERROR_ACTION_PARAM_KEY_NULL),!1;if(!Me.test(t))return xt.error(i.ERROR_ACTION_PARAM_KEY_INVALID),!1;De.test(t)&&xt.warn(i.WARN_ACTION_PARAM_KEY_RESERVED);var n=e[t];if(!i.isValidValue(n))return xt.error(Pe.format(i.ERROR_ACTION_PARAM_VALUE_INVALID,t,n)),!1;if(yt(n)){if(!i.isValidArrayValue(n)){for(var r=0;r<n.length;r++)xt.error(Pe.format(i.ERROR_ACTION_PARAM_VALUE_ARRAY_INVALID,t,Pe.customStringify(n),r,n[r]));return!1}if(!i.checkArrayElementTypes(n))return xt.error(i.ERROR_ACTION_PARAM_VALUE_ARRAY_TYPE_UNUNIQUE),!1}}}return!0}},{key:"isValidValue",value:function(e){return null==e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||yt(e)}},{key:"isValidArrayValue",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];if("string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n)return!1}return!0}},{key:"checkArrayElementTypes",value:function(e){if(e&&!(e.length<=1))for(var t=l(e[0]),n=1;n<e.length;n++)if(l(e[n])!==t)return!1;return!0}}]),i}(),qe=Ue,je=(qe.ERROR_ACTION_TYPE_NULL="在track方法中，action_type参数不能为空！",qe.ERROR_ACTION_TYPE_INVALID="在track方法中，action_type参数只能包含字母、数字和下划线，且只能以字母开头，长度不能超过64个字符！",qe.ERROR_ACTION_PARAM_KEY_NULL="在track方法中，action_param参数的key不能为空！",qe.ERROR_ACTION_PARAM_KEY_INVALID="在track方法中，action_param参数的key只能包含字母、数字和下划线，且不能以数字开头，长度不能超过64个字符！",qe.WARN_ACTION_PARAM_KEY_RESERVED="SDK内部预留参数的key均以'ams_reserved_'开头，该参数的值会被SDK内部覆盖，请不要使用！",qe.ERROR_ACTION_PARAM_VALUE_INVALID="在track方法中，action_param参数的value必须是String/Number/Boolean/Array中的一种！[key=${0}, value=${1}]",qe.ERROR_ACTION_PARAM_VALUE_ARRAY_INVALID="在track方法中，如果action_param参数中的某个元素的value是Array，那么这个Array中的每个元素必须是String/Number/Boolean中的一种！[key=${0}, value=${1}, 数组的第${2}个元素为${3}]",qe.ERROR_ACTION_PARAM_VALUE_ARRAY_TYPE_UNUNIQUE="在track方法中，如果action_param参数中的某个元素的value是Array，那么这个Array中所有元素的类型必须是同一种！",qe.ERROR_ACTION_PARAM_IS_NOT_OBJECT="action_param 参数不是Object",{exports:{}}),Fe=(!function(e){function p(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function s(e,t,n,r,i,o){return p((t=p(p(t,e),p(r,o)))<<i|t>>>32-i,n)}function f(e,t,n,r,i,o,a){return s(t&n|~t&r,e,t,i,o,a)}function d(e,t,n,r,i,o,a){return s(t&r|n&~r,e,t,i,o,a)}function h(e,t,n,r,i,o,a){return s(t^n^r,e,t,i,o,a)}function g(e,t,n,r,i,o,a){return s(n^(t|~r),e,t,i,o,a)}function a(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n,r,i,o,a=1732584193,s=-271733879,c=-1732584194,u=271733878,l=0;l<e.length;l+=16)a=f(n=a,r=s,i=c,o=u,e[l],7,-680876936),u=f(u,a,s,c,e[l+1],12,-389564586),c=f(c,u,a,s,e[l+2],17,606105819),s=f(s,c,u,a,e[l+3],22,-1044525330),a=f(a,s,c,u,e[l+4],7,-176418897),u=f(u,a,s,c,e[l+5],12,1200080426),c=f(c,u,a,s,e[l+6],17,-1473231341),s=f(s,c,u,a,e[l+7],22,-45705983),a=f(a,s,c,u,e[l+8],7,1770035416),u=f(u,a,s,c,e[l+9],12,-1958414417),c=f(c,u,a,s,e[l+10],17,-42063),s=f(s,c,u,a,e[l+11],22,-1990404162),a=f(a,s,c,u,e[l+12],7,1804603682),u=f(u,a,s,c,e[l+13],12,-40341101),c=f(c,u,a,s,e[l+14],17,-1502002290),a=d(a,s=f(s,c,u,a,e[l+15],22,1236535329),c,u,e[l+1],5,-165796510),u=d(u,a,s,c,e[l+6],9,-1069501632),c=d(c,u,a,s,e[l+11],14,643717713),s=d(s,c,u,a,e[l],20,-373897302),a=d(a,s,c,u,e[l+5],5,-701558691),u=d(u,a,s,c,e[l+10],9,38016083),c=d(c,u,a,s,e[l+15],14,-660478335),s=d(s,c,u,a,e[l+4],20,-405537848),a=d(a,s,c,u,e[l+9],5,568446438),u=d(u,a,s,c,e[l+14],9,-1019803690),c=d(c,u,a,s,e[l+3],14,-187363961),s=d(s,c,u,a,e[l+8],20,1163531501),a=d(a,s,c,u,e[l+13],5,-1444681467),u=d(u,a,s,c,e[l+2],9,-51403784),c=d(c,u,a,s,e[l+7],14,1735328473),a=h(a,s=d(s,c,u,a,e[l+12],20,-1926607734),c,u,e[l+5],4,-378558),u=h(u,a,s,c,e[l+8],11,-2022574463),c=h(c,u,a,s,e[l+11],16,1839030562),s=h(s,c,u,a,e[l+14],23,-35309556),a=h(a,s,c,u,e[l+1],4,-1530992060),u=h(u,a,s,c,e[l+4],11,1272893353),c=h(c,u,a,s,e[l+7],16,-155497632),s=h(s,c,u,a,e[l+10],23,-1094730640),a=h(a,s,c,u,e[l+13],4,681279174),u=h(u,a,s,c,e[l],11,-358537222),c=h(c,u,a,s,e[l+3],16,-722521979),s=h(s,c,u,a,e[l+6],23,76029189),a=h(a,s,c,u,e[l+9],4,-640364487),u=h(u,a,s,c,e[l+12],11,-421815835),c=h(c,u,a,s,e[l+15],16,530742520),a=g(a,s=h(s,c,u,a,e[l+2],23,-995338651),c,u,e[l],6,-198630844),u=g(u,a,s,c,e[l+7],10,1126891415),c=g(c,u,a,s,e[l+14],15,-1416354905),s=g(s,c,u,a,e[l+5],21,-57434055),a=g(a,s,c,u,e[l+12],6,1700485571),u=g(u,a,s,c,e[l+3],10,-1894986606),c=g(c,u,a,s,e[l+10],15,-1051523),s=g(s,c,u,a,e[l+1],21,-2054922799),a=g(a,s,c,u,e[l+8],6,1873313359),u=g(u,a,s,c,e[l+15],10,-30611744),c=g(c,u,a,s,e[l+6],15,-1560198380),s=g(s,c,u,a,e[l+13],21,1309151649),a=g(a,s,c,u,e[l+4],6,-145523070),u=g(u,a,s,c,e[l+11],10,-1120210379),c=g(c,u,a,s,e[l+2],15,718787259),s=g(s,c,u,a,e[l+9],21,-343485551),a=p(a,n),s=p(s,r),c=p(c,i),u=p(u,o);return[a,s,c,u]}function c(e){for(var t="",n=32*e.length,r=0;r<n;r+=8)t+=String.fromCharCode(e[r>>5]>>>r%32&255);return t}function u(e){var t=[];for(t[(e.length>>2)-1]=void 0,r=0;r<t.length;r+=1)t[r]=0;for(var n=8*e.length,r=0;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function r(e){for(var t,n="0123456789abcdef",r="",i=0;i<e.length;i+=1)t=e.charCodeAt(i),r+=n.charAt(t>>>4&15)+n.charAt(15&t);return r}function l(e){return unescape(encodeURIComponent(e))}function i(e){return c(a(u(e=l(e)),8*e.length))}function o(e,t){var n,e=l(e),t=l(t),r=u(e),i=[],o=[];for(i[15]=o[15]=void 0,16<r.length&&(r=a(r,8*e.length)),n=0;n<16;n+=1)i[n]=909522486^r[n],o[n]=1549556828^r[n];return e=a(i.concat(u(t)),512+8*t.length),c(a(o.concat(e),640))}function t(e,t,n){return t?n?o(t,e):r(o(t,e)):n?i(e):r(i(e))}var n;n=he,e.exports?e.exports=t:n.md5=t}(je),ye(je.exports)),Be="function"==typeof btoa,Ve="function"==typeof Buffer;"function"==typeof TextDecoder&&new TextDecoder;var Ge="function"==typeof TextEncoder?new TextEncoder:void 0,Qe=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Ke={},Ye=(Qe.forEach(function(e,t){return Ke[e]=t}),String.fromCharCode.bind(String)),We=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),Be?function(e){return btoa(e)}:Ve?function(e){return Buffer.from(e,"binary").toString("base64")}:function(e){for(var t,n,r,i="",o=e.length%3,a=0;a<e.length;){if(255<(t=e.charCodeAt(a++))||255<(n=e.charCodeAt(a++))||255<(r=e.charCodeAt(a++)))throw new TypeError("invalid character found");i+=Qe[(t=t<<16|n<<8|r)>>18&63]+Qe[t>>12&63]+Qe[t>>6&63]+Qe[63&t]}return o?i.slice(0,o-3)+"===".substring(o):i}),Je=Ve?function(e){return Buffer.from(e).toString("base64")}:function(e){for(var t=[],n=0,r=e.length;n<r;n+=4096)t.push(Ye.apply(null,e.subarray(n,n+4096)));return We(t.join(""))},He=function(e){var t;return e.length<2?(t=e.charCodeAt(0))<128?e:t<2048?Ye(192|t>>>6)+Ye(128|63&t):Ye(224|t>>>12&15)+Ye(128|t>>>6&63)+Ye(128|63&t):(t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320),Ye(240|t>>>18&7)+Ye(128|t>>>12&63)+Ye(128|t>>>6&63)+Ye(128|63&t))},ze=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,$e=Ve?function(e){return Buffer.from(e,"utf8").toString("base64")}:Ge?function(e){return Je(Ge.encode(e))}:function(e){return We(e.replace(ze,He))},Xe=Object.defineProperty,Ze=Object.getOwnPropertyDescriptor,tn=function(e,t,n,r){for(var i,o=1<r?void 0:r?Ze(t,n):t,a=e.length-1;0<=a;a--)(i=e[a])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&Xe(t,n,o),o},en=function(){function g(e){var t=this;f(this,g),this.cgiBatchSize=E.cgiBatchSize,this.reportThreshold=E.reportThreshold,this.reportDelay=E.reportDelay,this.triggerExecuteSend=function(r,e){var i,o=1<arguments.length&&void 0!==e?e:0,a=[];return function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return clearTimeout(i),i=setTimeout(function(){var t=r.apply(void 0,n);a.forEach(function(e){return e(t)}),a=[]},o),new Promise(function(e){return a.push(e)})}}(function(){t.executeSend()},1e3*this.reportDelay),this.inspectDelay=E.inspectDelay,this.inspectTimer=void 0,this.isNeedContinueSend=!1,this.getBaseInfo=e.getBaseInfo,this.reportLog=e.reportLog,this.queueManager=e.queueManager,this.configManager=e.configManager,this.flushSend(),this.startInspectTimer()}return v(g,[{key:"batchSend",value:function(){var e,t,n=this.queueManager.getReportableActions(this.reportThreshold);n.length>=this.reportThreshold||(t=(null==(e=this.configManager)?void 0:e.getRealTimeActionList())||E.realTimeActionList,n.some(function(e){return-1<t.indexOf(e.action_type)&&!e.is_retry}))?this.executeSend():this.triggerExecuteSend(),this.startInspectTimer()}},{key:"flushSend",value:function(){this.executeSend()}},{key:"executeSend",value:function(){var t=this;if(g.requestConcurrency<=g.currentRequestCount)this.isNeedContinueSend=!0;else{this.isNeedContinueSend=!1;var e=(g.requestConcurrency-g.currentRequestCount)*this.cgiBatchSize,n=this.queueManager.getReportableActions(e),r=this.getBaseInfo();if(r.openid||r.unionid||(xt.warn("请尽快调用 setOpenId 或 setUnionId 方法设置用户ID！"),n=n.filter(function(e){return null==e?void 0:e.ad_trace_id})),!(n.length<=0)){e<this.queueManager.getReportableActionsLength()&&(this.isNeedContinueSend=!0),g.currentRequestCount+=Math.ceil(n.length/this.cgiBatchSize);for(var i=[],o=0;o<n.length;o+=this.cgiBatchSize){var a=this.generateActionReportParams(n.slice(o,o+this.cgiBatchSize));i.push(this.report(a))}Promise.all(i).then(function(e){e=e.some(function(e){return 0<=e});t.isNeedContinueSend&&e&&t.executeSend()}).catch(function(e){xt.error(e),t.reportLog({message:"executeSend catch: ".concat(e.message),log_type:b.JS_RUN_ERROR,err_stack:e.stack})})}}}},{key:"generateActionReportParams",value:function(e){var t=[],n=[],r=this.getBaseInfo();return e.forEach(function(e){n.push(e.action_id);e=Object.assign({},e);delete e.inner_status,t.push(e)}),{data:{info:r,actions:t},actionIdList:n}}},{key:"dealSuccessData",value:function(e,t){-1<[51001,51003].indexOf(null==e?void 0:e.code)?this.queueManager.updateActionsForReportFail(t):this.queueManager.removeActions(t),0!==(null==e?void 0:e.code)&&(this.reportLog({log_type:b.REQUEST_ERROR,code:null==e?void 0:e.code,message:"trace_id: ".concat(null==e?void 0:e.trace_id,"，msg: ").concat(null==e?void 0:e.message)}),xt.error("上报失败：",e))}},{key:"dealFailData",value:function(e,t){this.queueManager.updateActionsForReportFail(t),this.reportLog({log_type:b.REQUEST_ERROR,code:e.code,message:e.message}),xt.error("上报失败：",e)}},{key:"report",value:function(e){var f=this,d=e.data,h=e.actionIdList;return this.queueManager.updateActionsForReporting(h),xt.debug&&(xt.info("上报行为类型: ","【".concat(d.actions.map(function(e){return e.action_type}).join("、"),"】")),xt.info("上报请求参数: ",d)),new Promise(function(n){var e,t,r,i,o,a=Date.now();try{var s=function(e){var t="",n=null==e?void 0:e.appid,r=null==e?void 0:e.secret_key,i=null==e?void 0:e.sdk_version,e=null==e?void 0:e.timestamp;if(n&&r&&i&&e&&32===r.length)for(var o=Fe(i+n+e),a=0;a<32;a++)t+=(a%2==0?r:o)[a];return t}({appid:null==(o=null==d?void 0:d.info)?void 0:o.appid,secret_key:null==(e=null==d?void 0:d.info)?void 0:e.secret_key,sdk_version:null==(t=null==d?void 0:d.info)?void 0:t.sdk_version,timestamp:a}),c=function(e,t){return 1<arguments.length&&void 0!==t&&t?$e(e).replace(/=/g,"").replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}):$e(e)}(JSON.stringify(d)),u={"Client-Time":a,"Sign-Value":Fe(c+(null==(r=null==d?void 0:d.info)?void 0:r.user_action_set_id)+(null==(i=null==d?void 0:d.info)?void 0:i.secret_key)+s),"Sign-Version":E.signVersion,"content-type":"text/plain;charset=UTF-8"},p=c}catch(s){u={"Client-Time":a},p=d,f.reportLog({log_type:b.SIGN_ERROR,message:"sign error msg: ".concat(null==s?void 0:s.message),err_stack:null==s?void 0:s.stack}),xt.error(s)}wx.request({url:"https://api.datanexus.qq.com/data-nexus-cgi/miniprogram",method:"POST",timeout:(null==(o=f.configManager)?void 0:o.getRequestTimeout())||E.requestTimeout,header:u,data:p,success:function(e){xt.devLog("上报接口返回码:",null==(t=null==e?void 0:e.data)?void 0:t.code);var t=(null==(t=null==e?void 0:e.header)?void 0:t["Server-Time"])||-1;if(st.revise(t),--g.currentRequestCount,200===(null==e?void 0:e.statusCode))f.dealSuccessData(null==e?void 0:e.data,h),n((null==e?void 0:e.data).code);else{t="";try{t="object"==l(null==e?void 0:e.data)?JSON.stringify(null==e?void 0:e.data):null==e?void 0:e.data}catch(e){xt.error(e)}e={code:"number"==typeof(null==e?void 0:e.statusCode)?-1*e.statusCode:-888,message:"statusCode: ".concat(null==e?void 0:e.statusCode,", data: ").concat(t)};f.dealFailData(e,h),n(e.code)}},fail:function(e){xt.devLog("上报失败:",e),--g.currentRequestCount;e={code:"number"==typeof(null==e?void 0:e.errno)?-1*e.errno:-999,message:null==e?void 0:e.errMsg};f.dealFailData(e,h),n(e.code)}})})}},{key:"startInspectTimer",value:function(){var e=this;clearTimeout(this.inspectTimer),this.inspectTimer=setTimeout(function(){g.requestConcurrency<=g.currentRequestCount&&(g.currentRequestCount=g.requestConcurrency-1),e.executeSend(),e.startInspectTimer()},1e3*this.inspectDelay)}}],[{key:"setRequestConcurrency",value:function(e){"number"==typeof e?e<1?xt.error("网络请求最大并发量不能小于1"):10<e?xt.error("网络请求最大并发量不能大于10"):g.requestConcurrency=e:xt.error("网络请求最大并发量需设置为数字")}}]),g}(),nn=en,rn=(nn.currentRequestCount=0,nn.requestConcurrency=E.requestConcurrency,tn([Lt],nn.prototype,"batchSend",1),tn([Lt],nn.prototype,"flushSend",1),tn([Lt],nn.prototype,"executeSend",1),Wt),on=Jt,an=Ht,un=zt,cn=$t,sn=ie,ln=Xt,fn=Zt,dn=te,vn=ne,pn=oe,hn=re,yn=ee,_n=function(){function e(){f(this,e)}return v(e,[{key:"install",value:function(i,e){function n(e){Qt.subscribe(e,function(n,e){var r=1<arguments.length&&void 0!==e?e:{};return function(e){i.track(n,Object.assign(r||{},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t(t({},wn,!0),Cn,e)))}}(e))}n(on),n(rn),n(an),n(un),"all"===e&&(n(cn),n(sn),n(ln),n(dn),n(fn),n(yn),n(vn),n(pn),n(hn))}}]),e}(),gn=function(){function e(){f(this,e),this.special_method_symbol=Symbol("special_method_symbol")}return v(e,[{key:"onPurchase",value:function(e){"number"!=typeof e&&xt.warn("付费金额需要为数字"),e<=0&&xt.warn("付费金额需要大于0"),this.wrapTrack(j,{value:e})}},{key:"onEnterForeground",value:function(){this.wrapTrack(D)}},{key:"onEnterBackground",value:function(){this.wrapTrack(U)}},{key:"onAppStart",value:function(){this.wrapTrack(M)}},{key:"onAppQuit",value:function(){this.wrapTrack(F)}},{key:"onAddToWishlist",value:function(){this.wrapTrack(q)}},{key:"wrapTrack",value:function(e,n){this.track(e,Object.assign(n||{},t({},this.special_method_symbol,1)))}}]),e}(),mn=function(){o(t,gn);var e=a(t);function t(){return f(this,t),e.apply(this,arguments)}return v(t,[{key:"onRegister",value:function(){this.wrapTrack(B)}},{key:"onCreateRole",value:function(e){e&&"string"!=typeof e&&xt.warn("角色名称需要为字符串"),this.wrapTrack(V,e?{name:e}:{})}},{key:"onTutorialFinish",value:function(){this.wrapTrack(K)}}]),t}(),An="（如果确认无误，请忽略该提示）",Rn=function(){var t=[];return{requestActionList:function(){try{lt({conf_name:"data_nexus_common",conf_key:"action_types"}).then(function(e){yt(e)&&(t=e)})}catch(e){xt.error(e)}},getActionList:function(){return t}}}();function kn(e,t){try{if(!e.is_sdk_auto_track){var r=e.action_type;try{var i=Rn.getActionList();if(!i.includes(r)){var o,a=function(e){var t,r,i,o,a,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return i=!(r=!0),{s:function(){s=s.call(e)},n:function(){var e=s.next();return r=e.done,e},e:function(e){i=!0,t=e},f:function(){try{r||null==s.return||s.return()}finally{if(i)throw t}}};if(Array.isArray(e)||(s=n(e)))return s&&(e=s),o=0,{s:a=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(i);try{for(a.s();!(o=a.n()).done;){var s=o.value;if(Tn(s,r)<=parseInt((.3*s.length).toString())){xt.warn("通过SDK上报的".concat(r,"行为名称可能有误，请检查该行为类型是否为腾讯广告提供的标准行为！").concat(An));break}}}catch(r){a.e(r)}finally{a.f()}}}catch(i){xt.error(i)}if("minigame"===t){var c,u,l,p=e,f=t;try{["PURCHASE","ADD_TO_CART"].includes(p.action_type)&&p.action_param&&It(p.action_param,"value")&&("number"!=typeof(null==(c=p.action_param)?void 0:c.value)?xt.warn("通过SDK上报的".concat(p.action_type,"行为携带的金额参数需要为数字！")):(null==(u=p.action_param)?void 0:u.value)<=0?xt.warn("通过SDK上报的".concat(p.action_type,"行为携带的金额参数需要大于0！")):"minigame"===f&&(null==(l=p.action_param)?void 0:l.value)<100&&xt.warn("通过SDK上报的".concat(p.action_type,"行为携带的金额参数可能有误，金额的单位为‘分’，请检查金额是否正确！").concat(An)))}catch(p){xt.error(p)}}else if("miniprogram"===t){var d=e;try{var h=null==d?void 0:d.action_type,g=(null==d?void 0:d.action_param)||{};"PURCHASE"===h&&It(g,"value")&&("number"!=typeof(null==g?void 0:g.value)?xt.warn("通过SDK上报的".concat(h,"行为携带的金额参数需要为数字！")):(null==g?void 0:g.value)<=0&&xt.warn("通过SDK上报的".concat(h,"行为携带的金额参数需要大于0！")))}catch(h){xt.error(h)}}}}catch(e){xt.error(e)}}function Tn(e,t){try{if(0===e.length)return t.length;if(0===t.length)return e.length;for(var n=[],r=0;r<=t.length;r++)n[r]=[r];for(var i=0;i<=e.length;i++)n[0][i]=i;for(var o=1;o<=t.length;o++)for(var a=1;a<=e.length;a++)t.charAt(o-1)===e.charAt(a-1)?n[o][a]=n[o-1][a-1]:n[o][a]=Math.min(n[o-1][a-1]+1,n[o][a-1]+1,n[o-1][a]+1);return n[t.length][e.length]}catch(n){xt.error(n)}}function Sn(e){try{e&&!/^[a-zA-Z0-9_\-]+$/.test(e)&&xt.warn("通过SDK上报的openid：".concat(e,"可能有误，请检查openid是否正确！").concat(An))}catch(e){xt.error(e)}}var En=Object.defineProperty,bn=Object.getOwnPropertyDescriptor,On=function(e,t,n,r){for(var i,o=1<r?void 0:r?bn(t,n):t,a=e.length-1;0<=a;a--)(i=e[a])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&En(t,n,o),o},In=Symbol("initializedInstance"),wn=Symbol("autoTrack"),Cn=Symbol("actionTime"),xn=function(){o(p,mn);var l=a(p);function p(e){var t,n,r,i,o,a,s;return(f(this,p),(t=l.call(this)).env="production",t.sdk_version="1.5.4",t.sdk_name="@dn-sdk/minigame",t.deviceInfo={},t.gameInfo={},t.session_id="",t.log_id=0,t.inited=!1,null!=wx&&wx.createCanvas)?(i=Ot(),p[In].length>=i.maxSdkInstance?xt.error("初始化超过上限"):(r=Et(e),n=at(),!0!==r?xt.error(r):(r=null==n?void 0:n.appId)&&r!==e.appid?xt.error("初始化失败，传入的appid与当前小游戏appid不一致"):(It(t.config=e,"auto_track")||(t.config.auto_track=bt("autoTrack")),t.openid=e.openid,t.unionid=e.unionid,t.user_unique_id=e.user_unique_id,t.saveValidOpenidToStorage(),r=e.user_action_set_id,p[In].includes(r)?xt.error("请勿重复初始化SDK"):(t.reportLog=t.reportLog.bind(c(t)),t.getTrackBaseInfo=t.getTrackBaseInfo.bind(c(t)),t.deviceInfo=nt(),t.gameInfo=Nt(),t.session_id=mt(),t.queueManage=new Vt({userActionSetId:r,maxLength:i.maxQueueLength,ogEvents:Yt}),t.actionReporter=new nn({getBaseInfo:t.getTrackBaseInfo,reportLog:t.reportLog,queueManager:t.queueManage,configManager:se}),t.inited=!0,p[In].push(r),t.useAutoTrack(),t.doReportOnEnterBackground(),"release"===(null==n?void 0:n.envVersion)?xt.info("初始化成功"):(i={conf_name:"mini_game_sdk_common",conf_key:"version",sdk_version:t.sdk_version,default_download_url:"https://sr-home-1257214331.cos.ap-guangzhou.myqcloud.com/sdk/dn-sdk-minigame/dn-sdk-minigame.zip",fail_handler:function(){t.inited=!1}},o=i.sdk_version,a=i.default_download_url,s=i.fail_handler,lt({conf_name:i.conf_name,conf_key:i.conf_key}).then(function(e){var t,n,r,i;if(ht(e))return t=null==e?void 0:e.blackVersions,n=null==e?void 0:e.minVersion,r=null==e?void 0:e.bestVersion,e=null==e?void 0:e.downloadUrl,i=a,e&&/^https/.test(e)&&(i=e),yt(t)&&-1<(null==t?void 0:t.indexOf(o))?(null!=s&&s(),void xt.error("初始化失败！当前SDK版本存在兼容问题，请尽快升级至最新版！下载地址：".concat(i))):n&&St(o,n)<0?(null!=s&&s(),void xt.error("初始化失败！当前SDK版本过低，请尽快升级至最新版！下载地址：".concat(i))):(r&&St(o,r)<0&&xt.warn("新版本SDK已上线，强烈建议您升级至最新版，尽早享受新特性！下载地址：".concat(i)),void xt.info("初始化成功"));xt.info("初始化成功")}).catch(function(){xt.info("初始化成功")}),Rn.requestActionList(),Sn(e.openid)))))):xt.error("SDK只可以用在微信小游戏中使用"),u(t)}return v(p,[{key:"track",value:function(e,t){var n=qe.validateActionType(e),r=qe.validateActionParam(t);n&&r&&(this.openid||this.unionid||xt.warn("缺少 openid 或 unionid"),n=bt("actionParamMaxLength"),JSON.stringify(t||{}).length>n?xt.error("监测到超过".concat(n,"的上报日志：").concat(e," ").concat(t)):(r=!(null==t||!t[wn]),n=this.createAction(e,t||{},r),"release"!==(null==(e=at())?void 0:e.envVersion)&&kn(n,"minigame"),null!=(t=this.queueManage)&&t.addAction(n),null!=(r=this.actionReporter)&&r.batchSend()))}},{key:"flush",value:function(){var e;null!=(e=this.actionReporter)&&e.flushSend()}},{key:"setOpenId",value:function(e){var t;e&&"string"==typeof e?(this.openid=e,this.gameInfo.ad_trace_id&&!tt$1.getSync(T)&&Qt.publish("START_APP"),this.flush(),this.saveValidOpenidToStorage(),"release"!==(null==(t=at())?void 0:t.envVersion)&&Sn(e)):xt.error("openid 格式错误")}},{key:"setUnionId",value:function(e){e&&"string"==typeof e?(this.unionid=e,this.flush()):xt.error("unionid 格式错误")}},{key:"setUserUniqueId",value:function(e){e&&"string"==typeof e?this.user_unique_id=e:xt.error("user_unique_id 格式错误")}},{key:"doReportOnEnterBackground",value:function(){var t=this;wx.onHide(function(){var e;null!=(e=t.actionReporter)&&e.flushSend(),null!=(e=t.queueManage)&&e.reportLostNum()})}},{key:"getTrackBaseInfo",value:function(){var t,n,e=at();return Object.assign({},this.deviceInfo,(t=this.config,n={},["user_action_set_id","appid","openid","secret_key","user_unique_id","unionid"].forEach(function(e){It(t,e)&&(n[e]=t[e])}),n),{local_id:rt(),sdk_name:this.sdk_name,sdk_version:this.sdk_version,openid:this.openid||it(),unionid:this.unionid,user_unique_id:this.user_unique_id,inner_param:{app_env_version:e.envVersion,app_version:e.version}})}},{key:"createAction",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=(null!=t&&t[wn]&&delete t[wn],Date.now()),r=(null!=t&&t[Cn]&&(r=null==t?void 0:t[Cn],delete t[Cn]),{action_id:mt(),action_param:t,action_time:r,action_type:e,is_retry:!1,is_sdk_auto_track:n,retry_count:0,revised_action_time:st.getRevisedcurrentTimeMillis(),log_id:++this.log_id,session_id:this.session_id,pkg_channel_id:this.gameInfo.pkg_channel_id,source_scene:this.gameInfo.source_scene,network_type:ot(),ad_trace_id:this.gameInfo.ad_trace_id,channel:this.getChannelByActionType(e)});return null!=t&&t[this.special_method_symbol]&&(this.addActionInnerParam(r,"is_special_method",!0),delete t[this.special_method_symbol]),-1<se.getChannelClaimActionList().indexOf(e)&&this.gameInfo.launch_options&&this.addActionInnerParam(r,"launch_options",this.gameInfo.launch_options),r}},{key:"addActionInnerParam",value:function(e,n,r){e.inner_param&&ht(e.inner_param)?e.inner_param[n]=r:e.inner_param=t({},n,r)}},{key:"getChannelByActionType",value:function(e){var t="";return-1<se.getChannelClaimActionList().indexOf(e)?t=this.gameInfo.channel||"":-1<se.getNoClaimActionList().indexOf(e)&&(t=X),t}},{key:"reportLog",value:function(e){var t={user_action_set_id:null==(t=this.config)?void 0:t.user_action_set_id,appid:null==(t=this.config)?void 0:t.appid,session_id:this.session_id};ct(Object.assign(t,e))}},{key:"useAutoTrack",value:function(){var e,t;null!=(e=this.config)&&e.auto_track&&(e=!0,(null==(t=tt$1.getSync(R))?void 0:t.ap)===G?e=!0:(null==t?void 0:t.ap)===Q&&(e=!1),"devtools"===nt().wx_platform&&(e=!0),(new _n).install(this,e?"all":"lifecycle"),pe(),e&&Le(),this.getAutoProxyRemoteConfig())}},{key:"getAutoProxyRemoteConfig",value:function(){var e,n,t=nt();t.os&&t.os_version&&null!=(e=this.config)&&e.user_action_set_id&&(n={conf_name:"MG",conf_param:{user_action_set_id:null==(e=this.config)?void 0:e.user_action_set_id,sdk_version:this.sdk_version,os_type:(null==t?void 0:t.os)||"",os_version:wt(t.os_version),device_brand:(null==t?void 0:t.device_brand)||"",weixin_lib_version:(null==t?void 0:t.wx_lib_version)||"",weixin_version:(null==t?void 0:t.wx_version)||""}},new Promise(function(t){wx.request({method:"POST",url:"https://api.datanexus.qq.com/data-nexus-config/v1/sdk/minigame/get",data:n,timeout:E.requestTimeout,success:function(e){ft(e,t,"minigame/get"),vt(e)},fail:function(e){dt(e,"minigame/get")}})}).then(function(e){ht(e)&&tt$1.setSync(R,e)}))}},{key:"saveValidOpenidToStorage",value:function(){this.openid&&/^[a-zA-Z0-9_-]{28,30}$/.test(this.openid)&&tt$1.setSync(T,this.openid)}}],[{key:"setRequestConcurrency",value:function(e){nn.setRequestConcurrency(e)}},{key:"setDebug",value:function(e){xt.debug=e}}]),p}(),Nn=xn,HttpTask=(Nn[In]=[],On([Lt,Pt],Nn.prototype,"track",1),On([Lt,Pt],Nn.prototype,"flush",1),On([Lt],Nn.prototype,"setOpenId",1),On([Lt],Nn.prototype,"setUnionId",1),On([Lt],Nn.prototype,"setUserUniqueId",1),On([Lt],Nn.prototype,"doReportOnEnterBackground",1),On([Lt],Nn.prototype,"getTrackBaseInfo",1),On([Lt],Nn.prototype,"useAutoTrack",1),function(){function s(e,t,n,r,i,o,a){_classCallCheck(this,s),this.data=e,this.serverUrl=t,this.callback=a,this.debugMode=i,this.platFormName=o,this.tryCount=_.isNumber(n)?n:1,this.permissionTryCount=6,this.timeout=_.isNumber(r)?r:3e3,this.taClassName="HttpTask"}return _createClass(s,[{key:"run",value:function(){var e,n=this,t=_.createExtraHeaders(),r=(t["content-type"]="application/json","debug"===this.debugMode&&(t["Turbo-Debug-Mode"]=1),"GravityEngine_ali_game"===this.platFormName?"headers":"header"),i=PlatformAPI.request((_defineProperty(e={url:this.serverUrl,method:"POST",data:this.data},r,t),_defineProperty(e,"success",function(e){var t;0===(null==e||null==(t=e.data)?void 0:t.code)?n.onSuccess(e):n.onFailed(e)}),_defineProperty(e,"fail",function(e){n.onFailed(e)}),e));setTimeout(function(){if((_.isObject(i)||_.isPromise(i))&&_.isFunction(i.abort))try{i.abort()}catch(e){}},this.timeout)}},{key:"onSuccess",value:function(e){var t,n;200===e.statusCode?(n="Data Verified",null!=e&&null!=(t=e.data)&&null!=(t=t.extra)&&null!=(t=t.errors)&&t.length&&(n=e.data.extra.errors),this.callback({code:null==e||null==(t=e.data)?void 0:t.code,msg:n})):this.callback({code:(null==e?void 0:e.statusCode)||-3,msg:e.statusCode})}},{key:"onFailed",value:function(e){var t,n=this;0<--this.tryCount?setTimeout(function(){n.run()},1e3):this.callback({code:-3,msg:"".concat(null==e||null==(t=e.data)?void 0:t.msg,"：").concat(null==e||null==(t=e.data)||null==(t=t.extra)?void 0:t.error)})}}]),s}()),SenderQueue=function(){function e(){_classCallCheck(this,e),this.items=[],this.isRunning=!1,this.showDebug=!1}return _createClass(e,[{key:"enqueue",value:function(e,t,n){var r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],i="debug"===n.debugMode,o=this,e=new HttpTask(JSON.stringify(e),t,n.maxRetries,n.sendTimeout,n.debugMode,n.platFormName,function(e){o.isRunning=!1,_.isFunction(n.callback)&&n.callback(e),o._runNext(i),i&&logger.info("code ".concat(e.code," and msg is,"),e.msg)});!0===r?(this.items.push(e),this._runNext(i)):e.run()}},{key:"_dequeue",value:function(){return this.items.shift()}},{key:"_runNext",value:function(e){if(0<this.items.length&&!this.isRunning)if(this.isRunning=!0,e)this._dequeue().run();else{for(var t=this.items.splice(0,this.items.length),e=t[0],n=JSON.parse(e.data),r=1;r<t.length;r++){var i=t[r],i=JSON.parse(i.data);n.event_list=n.event_list.concat(i.event_list)}var o=(new Date).getTime();n.$flush_time=o,new HttpTask(JSON.stringify(n),e.serverUrl,e.tryCount,e.timeout,null==e?void 0:e.debugMode,e.platFormName,e.callback).run()}}}]),e}(),senderQueue=new SenderQueue,DEFAULT_CONFIG={name:"GravityEngine",is_plugin:!1,maxRetries:3,sendTimeout:5e3,enablePersistence:!0,asyncPersistence:!1,strict:!1,debugMode:"none"},systemInformation={properties:{$lib_version:Config.LIB_VERSION,$lib:Config.LIB_STACK,$scene:"",$today_first_scene:""},getSystemInfo:function(e){var n=this;PlatformAPI.onNetworkStatusChange(function(e){n.properties.$network_type=e.networkType}),PlatformAPI.getNetworkType({success:function(e){n.properties.$network_type=e.networkType},complete:function(){PlatformAPI.getSystemInfo({success:function(e){logger.info(JSON.stringify(e,null,4));var t={$manufacturer:e.brand,$brand:e.brand,$model:e.model,$screen_width:Number(e.screenWidth),$screen_height:Number(e.screenHeight),$system_language:e.language,$os:e.platform,$os_version:e.system};_.extend(n.properties,t),_.setMpPlatform(e.mp_platform)},complete:function(){e()}})}})}},GravityEnginePersistence=function(){function e(t,n){var r=this;_classCallCheck(this,e),this.enabled=t.enablePersistence,this.enabled?(t.isChildInstance?(this.name=t.persistenceName+"_"+t.name,this.nameOld=t.persistenceNameOld+"_"+t.name):(this.name=t.persistenceName,this.nameOld=t.persistenceNameOld),t.asyncPersistence?(this._state={},PlatformAPI.getStorage(this.name,!0,function(e){_.isEmptyObject(e)?PlatformAPI.getStorage(r.nameOld,!0,function(e){r._state=_.extend2Layers({},e,r._state),r._init(t,n),r._save()}):(r._state=_.extend2Layers({},e,r._state),r._init(t,n),r._save())})):(this._state=PlatformAPI.getStorage(this.name)||{},_.isEmptyObject(this._state)&&(this._state=PlatformAPI.getStorage(this.nameOld)||{}),this._init(t,n))):(this._state={},this._init(t,n))}return _createClass(e,[{key:"_init",value:function(e,t){this.getDistinctId()||this.setDistinctId(_.UUID()),e.isChildInstance||this.getDeviceId()||this._setDeviceId(_.UUID()),this.initComplete=!0,"function"==typeof t&&t();var e=PlatformAPI.getStorage(this.name),t=null==e?void 0:e.current_first_scene_date,n=null==e?void 0:e.current_first_scene,r=(new Date).toLocaleDateString();n&&t&&t===r?systemInformation.properties.$today_first_scene=String(null==e?void 0:e.current_first_scene):(e=String((null==(n=PlatformAPI.getAppOptions())?void 0:n.scene)||(null==(t=PlatformAPI.getAppOptions())?void 0:t.from)),systemInformation.properties.$today_first_scene=e,this._state.current_first_scene=e,this._state.current_first_scene_date=r),this._save()}},{key:"_save",value:function(){this.enabled&&this.initComplete&&PlatformAPI.setStorage(this.name,JSON.stringify(this._state))}},{key:"_set",value:function(e,t){var n,r=this;"string"==typeof e?(n={})[e]=t:"object"===_typeof(e)&&(n=e),_.each(n,function(e,t){r._state[t]=e}),this._save()}},{key:"_get",value:function(e){return this._state[e]}},{key:"setEventTimer",value:function(e,t){var n=this._state.event_timers||{};n[e]=t,this._set("event_timers",n)}},{key:"removeEventTimer",value:function(e){var t=(this._state.event_timers||{})[e];return _.isUndefined(t)||(delete this._state.event_timers[e],this._save()),t}},{key:"getDeviceId",value:function(){return this._state.device_id}},{key:"_setDeviceId",value:function(e){this.getDeviceId()?logger.warn("cannot modify the device id."):this._set("device_id",e)}},{key:"getDistinctId",value:function(){return this._state.distinct_id}},{key:"setDistinctId",value:function(e){this._set("distinct_id",e)}},{key:"getAccountId",value:function(){return this._state.account_id}},{key:"setAccountId",value:function(e){this._set("account_id",e)}},{key:"getSuperProperties",value:function(){return this._state.props||{}}},{key:"setSuperProperties",value:function(e,t){t=t?e:_.extend(this.getSuperProperties(),e);this._set("props",t)}}]),e}();function getPlatFormName(){return PlatformAPI.getConfig().persistenceNameOld}var GravityEngineAPI=function(){function n(e){_classCallCheck(this,n),e.appId=_.checkAppId((null==e?void 0:e.clientId)||""),e.accessToken=e.accessToken,e.accessToken||console.warn("GravityAnalytics: accessToken must be required"),e.autoTrack={appLaunch:!0,appShow:!0,appHide:!0,pageShare:!0},e.serverUrl="".concat(Config.BASE_URL,"/event/collect/?access_token=").concat(e.accessToken);var t=_.extend({},DEFAULT_CONFIG,PlatformAPI.getConfig());_.isObject(e)?this.config=_.extend(t,e):this.config=t,this._init(this.config)}var e,t,r,i,o,a,s,c,u,l;return _createClass(n,[{key:"_init",value:function(e){var t=this,n=(this.name=e.name,this.appId=e.clientId,this.accessToken=e.accessToken,this.platFormName=getPlatFormName(),_.isObject(e.tencentSdkData)&&"GravityEngine_wechat_game"===this.platFormName&&(null!=(n=e.tencentSdkData)&&n.enableDebug&&(Nn.setDebug(!0),logger.tencentSdkLog("setDebug")),this.sdk=new Nn({user_action_set_id:e.tencentSdkData.user_action_set_id,secret_key:e.tencentSdkData.secret_key,appid:e.tencentSdkData.appid})),e.serverUrl||e.server_url),n=(this.serverUrl=n,this.serverDebugUrl=n,this.configUrl=n+"/config",this.autoTrackProperties={},this._queue=[],this.config.syncBatchSize=100,this.config.syncInterval=60,e.isChildInstance?this._state={}:(logger.enabled="debug"===e.debugMode,this.instances=[],this._state={getSystemInfo:!1,initComplete:!1},systemInformation.getSystemInfo(function(){t._updateState({getSystemInfo:!0})}),PlatformAPI.setGlobal(this,this.name)),systemInformation.properties.$scene=String((null==(n=PlatformAPI.getAppOptions())?void 0:n.scene)||(null==(n=PlatformAPI.getAppOptions())?void 0:n.from)),this.store=new GravityEnginePersistence(e,function(){t.config.asyncPersistence&&_.isFunction(t.config.persistenceComplete)&&t.config.persistenceComplete(t),t._updateState()}),this.enabled=!_.isBoolean(this.store._get("ge_enabled"))||this.store._get("ge_enabled"),this.isOptOut=!!_.isBoolean(this.store._get("ge_isOptOut"))&&this.store._get("ge_isOptOut"),getPlatFormName()),r="GravityEngine_quick_mp"===n;(r||"GravityEngine_wechat_game"===n||"GravityEngine_taobao_game"===n||"GravityEngine_tt_game"===n||"GravityEngine_ali_game"===n||n.includes("gravityengine_qg"))&&this.track(r?"$AppStart":"$MPLaunch",{$url_query:_.setQuery(this.getQuery())}),e.isChildInstance||(this.autoTrack=PlatformAPI.initAutoTrackInstance(this,e))}},{key:"updateConfig",value:function(e,t){}},{key:"initInstance",value:function(e,t){if(!this.config.isChildInstance)return _.isString(e)&&e!==this.name&&_.isUndefined(this[e])?(t=new n(_.extend({},this.config,{enablePersistence:!1,isChildInstance:!0,name:e},t)),this[e]=t,this.instances.push(e),this[e]._state=this._state,t):void logger.warn("initInstance() failed due to the name is invalid: "+e);logger.warn("initInstance() cannot be called on child instance")}},{key:"lightInstance",value:function(e){return this[e]}},{key:"_setAutoTrackProperties",value:function(e){_.extend(this.autoTrackProperties,e)}},{key:"setupAndStart",value:function(e){var t=this;if(null!=e&&e.clientId&&(this.config.appId=e.clientId,this.appId=e.clientId),this.openId=(null==e?void 0:e.openId)||this.appId,this.sdk&&(this.sdk.setOpenId(this.openId),logger.tencentSdkLog("setOpenId"),PlatformAPI.getStorage("is_ge_registered",!0,function(e){"Y"===e&&t._setDryRunValue(0).then(function(){t.config.tencentSdkData.enableDryRun?t.tryDryRun({actionList:["pay","tutorial_finish","create_role","re_active","register"]}):t.tencentSDKRegisterTrack()})})),this._state.initComplete)return!1;this._updateState({initComplete:!0})}},{key:"preInit",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=PlatformAPI.getStorage("gravity_pre_cache",!1),(t=null!=t&&t.latest_cache_time?Number(null==t?void 0:t.latest_cache_time):0)&&Date.now()-t<864e5)return e.abrupt("return");e.next=4;break;case 4:t=PlatformAPI.getAppOptions(),n=_.isObject(null==t?void 0:t.query)?t.query:{},n={latest_cache_time:Date.now(),gravity_query_cache:n,gravity_scene_cache:(null==t?void 0:t.scene)||""},PlatformAPI.setStorage("gravity_pre_cache",JSON.stringify(n));case 8:case"end":return e.stop()}},e)})),function(){return l.apply(this,arguments)})},{key:"_getPreCache",value:function(){var e,t={cache_query:{},cache_scene:""},n=PlatformAPI.getStorage("gravity_pre_cache",!1);return!_.isObject(n)||_.isEmptyObject(n)||(e=null!=n&&n.latest_cache_time?Number(null==n?void 0:n.latest_cache_time):0)&&864e5<Date.now()-e?t:(e=(null==n?void 0:n.gravity_query_cache)||{},{cache_query:_.isObject(e)&&!_.isEmptyObject(e)?e:{},cache_scene:(null==n?void 0:n.gravity_scene_cache)||""})}},{key:"_isReady",value:function(){return this._state.getSystemInfo&&this._state.initComplete&&this.store.initComplete&&this.config.appId&&this.config.accessToken}},{key:"_updateState",value:function(e){var t=this;_.isObject(e)&&_.extend(this._state,e),this._onStateChange(),_.each(this.instances,function(e){t[e]._onStateChange()})}},{key:"_onStateChange",value:function(){var t=this;this._isReady()&&this._queue&&0<this._queue.length&&(_.each(this._queue,function(e){t[e[0]].apply(t,slice.call(e[1]))}),this._queue=[])}},{key:"_hasDisabled",value:function(){var e=!this.enabled||this.isOptOut;return e&&logger.info("GravityEngine is Pause or Stop!"),e}},{key:"_sendRequest",value:function(e,t,n){if(!this._hasDisabled())if(!_.isUndefined(this.config.disableEventList)&&this.config.disableEventList.includes(e.eventName))logger.info("disabled Event : "+e.eventName);else{t=_.isDate(t)?t:new Date;var t={event_list:[{type:e.type,time:new Date(t).getTime()}]},r=(t.event_list[0].event=e.eventName,"track"===e.type?(t.event_list[0].properties=this.getSendProperties(),r=this.store.removeEventTimer(e.eventName),_.isUndefined(r)||(r=(new Date).getTime()-r,86400<(r=parseFloat((r/1e3).toFixed(3)))?r=86400:r<0&&(r=0),t.event_list[0].properties.$event_duration=r)):t.event_list[0].properties={},_.isObject(e.properties)&&!_.isEmptyObject(e.properties)&&_.extend(t.event_list[0].properties,e.properties),_.searchObjDate(t.event_list[0]),t.client_id=this.appId,logger.info(JSON.stringify(t,null,4)),this.serverUrl);if(_.isBoolean(this.config.enableEncrypt)&&1==this.config.enableEncrypt&&(t.event_list[0]=_.generateEncryptyData(t.event_list[0],void 0)),n){var i,n=new FormData;"debug"===this.config.debugMode?(n.append("source","client"),n.append("appid",this.appId),n.append("deviceId",this.getDeviceId()),n.append("data",JSON.stringify(t.event_list[0]))):(i=_.base64Encode(JSON.stringify(t)),n.append("data",i));try{navigator.sendBeacon(r,n)}catch(e){}_.isFunction(e.onComplete)&&e.onComplete({statusCode:200})}else senderQueue.enqueue(t,r,{maxRetries:this.config.maxRetries,sendTimeout:this.config.sendTimeout,callback:e.onComplete,debugMode:this.config.debugMode,platFormName:this.platFormName})}}},{key:"_isObjectParams",value:function(e){return _.isObject(e)&&_.isFunction(e.onComplete)}},{key:"track",value:function(e,t,n,r){var i;this._hasDisabled()||(this._isObjectParams(e)&&(e=(i=e).eventName,t=i.properties,n=i.time,r=i.onComplete),null!=(i=t=_.isObject(t)?t:{})&&i.$trace_id||(t.$trace_id=_.UUID()),PropertyChecker.event(e)&&PropertyChecker.properties(t)||!this.config.strict?this._internalTrack(e,t,n,r):_.isFunction(r)&&r({code:-1,msg:"invalid parameters"}))}},{key:"_internalTrack",value:function(e,t,n,r,i){this._hasDisabled()||(n=_.isDate(n)?n:new Date,this._isReady()?this._sendRequest({type:"track",eventName:e,properties:t,onComplete:r},n,i):this._queue.push(["_internalTrack",[e,t,n,r]]))}},{key:"userSet",value:function(e,t,n){var r;this._hasDisabled()||(this._isObjectParams(e)&&(e=(r=e).properties,t=r.time,n=r.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_set",properties:e,onComplete:n},t):this._queue.push(["userSet",[e,t,n]])):(logger.warn("calling userSet failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userSetOnce",value:function(e,t,n){var r;this._hasDisabled()||(this._isObjectParams(e)&&(e=(r=e).properties,t=r.time,n=r.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_set_once",properties:e,onComplete:n},t):this._queue.push(["userSetOnce",[e,t,n]])):(logger.warn("calling userSetOnce failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userAdd",value:function(e,t,n){var r;this._hasDisabled()||(this._isObjectParams(e)&&(e=(r=e).properties,t=r.time,n=r.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_increment",properties:e,onComplete:n},t):this._queue.push(["userAdd",[e,t,n]])):(logger.warn("calling userAdd failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userNumberMax",value:function(e,t,n){if(!this._hasDisabled()){var r,i,o;for(i in this._isObjectParams(e)&&(e=(r=e).properties,t=r.time,n=r.onComplete),e)if("number"!=typeof e[i])return o="The key ".concat(i," must be type of number"),console.warn(o),void(_.isFunction(n)&&n({code:-1,msg:o}));PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_number_max",properties:e,onComplete:n},t):this._queue.push(["userNumberMax",[e,t,n]])):(logger.warn("calling userNumberMax failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"}))}}},{key:"userNumberMin",value:function(e,t,n){if(!this._hasDisabled()){var r,i,o;for(i in this._isObjectParams(e)&&(e=(r=e).properties,t=r.time,n=r.onComplete),e)if("number"!=typeof e[i])return o="The key ".concat(i," must be type of number"),console.warn(o),void(_.isFunction(n)&&n({code:-1,msg:o}));PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_number_min",properties:e,onComplete:n},t):this._queue.push(["userNumberMin",[e,t,n]])):(logger.warn("calling userNumberMin failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"}))}}},{key:"userDel",value:function(e,t){var n,r={};this._hasDisabled()||(this._isObjectParams(r)&&(r=(n=r).properties,e=n.time,t=n.onComplete),PropertyChecker.propertiesMust(r)||!this.config.strict?(e=_.isDate(e)?e:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_delete",properties:r,onComplete:t},e):this._queue.push(["userDel",[r,e,t]])):(logger.warn("calling userDel failed due to invalid arguments"),_.isFunction(t)&&t({code:-1,msg:"invalid parameters"})))}},{key:"userAppend",value:function(e,t,n){var r;this._hasDisabled()||(this._isObjectParams(e)&&(e=(r=e).properties,t=r.time,n=r.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_append",properties:e,onComplete:n},t):this._queue.push(["userAppend",[e,t,n]])):(logger.warn("calling userAppend failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userUniqAppend",value:function(e,t,n){var r;this._hasDisabled()||(this._isObjectParams(e)&&(e=(r=e).properties,t=r.time,n=r.onComplete),PropertyChecker.userAppendProperties(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_uniq_append",properties:e,onComplete:n},t):this._queue.push(["userUniqAppend",[e,t,n]])):(logger.warn("calling userAppend failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userUnset",value:function(e,t,n){var r,e=_defineProperty({},e,null);this._hasDisabled()||(this._isObjectParams(e)&&(e=(r=e).properties,t=r.time,n=r.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_unset",properties:e,onComplete:n},t):this._queue.push(["userUnset",[e,t,n]])):(logger.warn("calling userUnset failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"getQuickAppInfo",value:function(){return new Promise(function(r,e){var t;PlatformAPI.getQuickDevice({success:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={os_name:"android",android_id:t.user,imei:t.device,oaid:t.oaid,mac:t.mac,android_version:t.system,api_version:t.osVersionCode,rom:t.vendorOsName,rom_version:t.vendorOsVersion,phone_brand:t.manufacturer,phone_model:t.model},e.abrupt("return",r(n));case 2:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})})})}},{key:"getQuickGameInfo",value:function(){return new Promise(function(t){var e=getPlatFormName();PlatformAPI.getQuickDevice({platform:e,success:function(e){return t(e)}})})}},{key:"uploadQuickAppDeviceInfo",value:function(){var a=this;return new Promise(function(i,o){var t;PlatformAPI.getQuickDevice({success:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={os_name:"android",android_id:t.user,imei:t.device,oaid:t.oaid,mac:t.mac,android_version:t.system,api_version:t.osVersionCode,rom:t.vendorOsName,rom_version:t.vendorOsVersion,phone_brand:t.manufacturer,phone_model:t.model},r="".concat(Config.BASE_URL,"/user/device_info/?access_token=").concat(a.accessToken,"&client_id=").concat(a.appId),e.next=4,a.sendNetWork(r,{data:n});case 4:return r=e.sent,e.abrupt("return",(0===r.code?i:o)(r));case 6:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})})})}},{key:"uploadQuickGameDeviceInfo",value:function(){var a=this;return new Promise(function(i,o){var t,e=getPlatFormName();PlatformAPI.getQuickDevice({platform:e,success:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,r="".concat(Config.BASE_URL,"/user/device_info/?access_token=").concat(a.accessToken,"&client_id=").concat(a.appId),e.next=4,a.sendNetWork(r,{data:n});case 4:return r=e.sent,e.abrupt("return",(0===r.code?i:o)(r));case 6:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})})})}},{key:"logoutEvent",value:function(){this.track("$MPLogout",{})}},{key:"loginEvent",value:function(){this.track("$MPLogin",{})}},{key:"registerEvent",value:function(){"GravityEngine_quick_mp"===getPlatFormName()?this.track("$AppRegister",{}):this.track("$MPRegister",{})}},{key:"payEvent",value:function(n,r,i,o,a){var s=this;if("number"!=typeof n)throw new Error("pay_amount must be a number");if("string"!=typeof r)throw new Error("pay_type must be a string");if("string"!=typeof i)throw new Error("order_id must be a string");if("string"!=typeof o)throw new Error("pay_reason must be a string");if("string"!=typeof a)throw new Error("pay_method must be a string");return new Promise(function(e,t){s.track("$PayEvent",{$pay_amount:n,$pay_type:r,$order_id:i,$pay_reason:o,$pay_method:a},null,function(){e()})})}},{key:"bindTAThirdPlatform",value:function(e,t){if(!e&&!t)throw new Error("taAccountId or taDistinctId must be required");if(e&&"string"!=typeof e)throw new Error("taAccountId must be a string");if(t&&"string"!=typeof t)throw new Error("taDistinctId must be a string");this.track("$BindThirdPlatform",{$third_platform_type:"ta",$ta_account_id:e,$ta_distinct_id:t})}},{key:"adShowEvent",value:function(e,t,n){var r=getPlatFormName();if("GravityEngine_wechat"===r||"GravityEngine_wechat_game"===r||"GravityEngine_ali_game"===r||r.startsWith("gravityengine_qg")||r.startsWith("GravityEngine_quick")){if("string"!=typeof e)throw new Error("ad_type must be a string");if("string"!=typeof t)throw new Error("ad_unit_id must be a string");if("GravityEngine_wechat"===r&&!t.startsWith("adunit-"))throw new Error("您传入的ad_unit_id格式不正确，请检查");r={$ad_type:e,$ad_unit_id:t,$adn_type:"media"};"[object Object]"===Object.prototype.toString.call(n)&&Object.assign(r,n),this.track("$AdShow",r)}}},{key:"getQuery",value:function(){try{var e;return null!=PlatformAPI&&PlatformAPI.getAppOptions&&null!=(e=PlatformAPI.getAppOptions())&&e.query?PlatformAPI.getAppOptions().query||{}:{}}catch(e){return{}}}},{key:"sendNetWork",value:function(r,i){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"POST",a="GravityEngine_ali_game"===this.platFormName?"headers":"header";return new Promise(function(t,n){var e;PlatformAPI.request((_defineProperty(e={url:r,method:o,data:"string"==typeof i?i:JSON.stringify(i)},a,{"content-type":"application/json"}),_defineProperty(e,"success",function(e){200===e.statusCode||200===e.status?t(e.data):n(e)}),_defineProperty(e,"fail",function(e){n(e)}),e))})}},{key:"_errorPromise",value:function(e){return Promise.reject(new Error(e))}},{key:"initializeWithHistoryUserInfo",value:(u=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,r=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<r.length&&void 0!==r[0]?r[0]:{},n=1<r.length?r[1]:void 0,e.abrupt("return",this.initialize(t,n));case 3:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"initialize",value:(c=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var y,k,b=this,t=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return y=0<t.length&&void 0!==t[0]?t[0]:{},k=1<t.length?t[1]:void 0,e.abrupt("return",new Promise(function(){var n=_asyncToGenerator(_regeneratorRuntime().mark(function e(m,v){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{PlatformAPI.getStorage("is_ge_registered",!0,function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(n){var r,i,o,a,s,c,u,l,p,f,d,h,g;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i="",b._state.initComplete?null!=y&&y.name?null!=y&&y.version||0===(null==y?void 0:y.version)?_.isNumber(null==y?void 0:y.version)&&"number"==typeof(null==y?void 0:y.version)?void 0!==k&&("[object Object]"!==Object.prototype.toString.call(k)?i="history_info must be type: Object":null!=k&&k.company?"string"!=typeof k.company?i="history_info.company must be type: String":null!=k&&k.create_time||0===k.create_time?_.isNumber(k.create_time)&&"number"==typeof k.create_time||(i="history_info.create_time must be type: Number"):i="history_info.create_time must be required":i="history_info.company must be required"):i="version must be type: Number":i="version must be required":i="name must be required":i="initialize must be called after setupAndStart",i)return e.abrupt("return",v(i));e.next=4;break;case 4:if(t=void 0,t=b.getQuery(),r=_.isObject(t)&&!_.isEmptyObject(t)?t:(t=b._getPreCache().cache_query,_.isObject(t)&&!_.isEmptyObject(t)?_objectSpread2(_objectSpread2({},t),{},{gravity_launch_cache:1}):{}),i=getPlatFormName(),a=i.includes("GravityEngine_ali"),o=(null==y?void 0:y.channel)||"base_channel",s=(null==y?void 0:y.enable_sync_attribution)||!1,a={client_id:b.appId,name:y.name,channel:a&&null!=r&&r.channel?r.channel:o,version:y.version,wx_openid:(null==y?void 0:y.openid)||(null==y?void 0:y.wx_openid)||b.openId||"",wx_unionid:(null==y?void 0:y.wx_unionid)||"",promoted_object_id:(null==y?void 0:y.promoted_object_id)||"",need_return_attribution:s,ad_data:r},k&&(a.history_info=k),"GravityEngine_quick_mp"===(s=getPlatFormName()))return e.next=15,b.getQuickAppInfo();e.next=16;break;case 15:a.device_info=e.sent;case 16:if(s.includes("gravityengine_qg"))return e.next=19,b.getQuickGameInfo();e.next=20;break;case 19:a.device_info=e.sent;case 20:return u="".concat(Config.BASE_URL,"/user/initialize/?access_token=").concat(b.accessToken,"&client_id=").concat(b.appId),e.next=23,b.sendNetWork(u,a);case 23:if(0!==(c=e.sent).code)return e.abrupt("return",v(c));e.next=26;break;case 26:u=systemInformation.properties,g=new Date,l=g.getFullYear(),p=("0"+(g.getMonth()+1)).slice(-2),f=("0"+g.getDate()).slice(-2),d=("0"+g.getHours()).slice(-2),h=("0"+g.getMinutes()).slice(-2),g=("0"+g.getSeconds()).slice(-2),l="".concat(l,"-").concat(p,"-").concat(f," ").concat(d,":").concat(h,":").concat(g),"Y"!==n&&(p={$channel:o,$manufacturer:u.$manufacturer,$model:u.$model,$brand:u.$brand,$os:u.$os,$first_visit_time:l},f=function(e){e=null==(e=PlatformAPI.getAppOptions())?void 0:e.scene;return e?String(e):b._getPreCache().cache_scene||""}(),p.$first_scene=f,null!=r&&r.gravity_referee_openid&&(p.$gravity_referee_openid=r.gravity_referee_openid),b.userSetOnce(p),d=_.setQuery(b.getQuery()),h="GravityEngine_quick_mp"===s?"$AppStart":"$MPLaunch",g={$url_query:d},b.track(h,g),b.track("$MPShow",g),b.tryRegisterEventDryRun());try{PlatformAPI.removeStorage("gravity_pre_cache")}catch(e){}return PlatformAPI.setStorage("is_ge_registered",JSON.stringify("Y")),e.abrupt("return",m(c));case 39:case"end":return e.stop()}var t},e)}));return function(e){return t.apply(this,arguments)}}())}catch(e){v(e)}case 1:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e)})),function(){return c.apply(this,arguments)})},{key:"authorizeOpenID",value:function(e){this.identify(e)}},{key:"identify",value:function(e){if(!this._hasDisabled()){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return!1;this.store.setDistinctId(e)}}},{key:"getDistinctId",value:function(){return this.store.getDistinctId()}},{key:"login",value:function(e){if(!this._hasDisabled()){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return!1;this.store.setAccountId(e)}}},{key:"getAccountId",value:function(){return this.store.getAccountId()}},{key:"logout",value:function(){this._hasDisabled()||this.store.setAccountId(null)}},{key:"setSuperProperties",value:function(e){this._hasDisabled()||(PropertyChecker.propertiesMust(e)||!this.config.strict?this.store.setSuperProperties(e):logger.warn("setSuperProperties parameter must be a valid property value"))}},{key:"clearSuperProperties",value:function(){this._hasDisabled()||this.store.setSuperProperties({},!0)}},{key:"unsetSuperProperty",value:function(e){var t;this._hasDisabled()||_.isString(e)&&(delete(t=this.getSuperProperties())[e],this.store.setSuperProperties(t,!0))}},{key:"getSuperProperties",value:function(){return this.store.getSuperProperties()}},{key:"getSendProperties",value:function(){try{var e,t=_.extend({},systemInformation.properties,this.autoTrackProperties,this.store.getSuperProperties(),this.dynamicProperties?this.dynamicProperties():{});for(e in t)"string"==typeof t[e]&&(t[e]=t[e].substring(0,8192));return t}catch(e){return{}}}},{key:"getPresetProperties",value:function(){var e=systemInformation.properties,t={},n=e.$system_language,n=(t.system_language=_.isUndefined(n)?"":n,e.$os),n=(t.os=_.isUndefined(n)?"":n,e.$screen_width),n=(t.screenWidth=_.isUndefined(n)?0:n,e.$screen_height),n=(t.screenHeight=_.isUndefined(n)?0:n,e.$network_type),n=(t.networkType=_.isUndefined(n)?"":n,e.$model),n=(t.deviceModel=_.isUndefined(n)?"":n,e.$os_version),n=(t.osVersion=_.isUndefined(n)?"":n,t.deviceId=this.getDeviceId(),0-(new Date).getTimezoneOffset()/60),n=(t.zoneOffset=n,e.$manufacturer),n=(t.manufacturer=_.isUndefined(n)?"":n,e.$manufacturer);return t.brand=_.isUndefined(n)?"":n,t.toEventPresetProperties=function(){var e;return{$app_id:this.appId,$model:t.deviceModel,$screen_width:t.screenWidth,$screen_height:t.screenHeight,$system_language:t.system_language,$os:t.os,$os_version:t.osVersion,$network_type:t.networkType,$manufacturer:t.manufacturer,$brand:t.manufacturer,$scene:String((null==(e=PlatformAPI.getAppOptions())?void 0:e.scene)||(null==(e=PlatformAPI.getAppOptions())?void 0:e.from))}},t}},{key:"setDynamicSuperProperties",value:function(e){this._hasDisabled()||("function"==typeof e?PropertyChecker.properties(e())||!this.config.strict?this.dynamicProperties=e:logger.warn("A dynamic public property must return a valid property value"):logger.warn("setDynamicSuperProperties parameter must be a function type"))}},{key:"timeEvent",value:function(e,t){this._hasDisabled()||(t=_.isDate(t)?t:new Date,this._isReady()?PropertyChecker.event(e)||!this.config.strict?this.store.setEventTimer(e,t.getTime()):logger.warn("calling timeEvent failed due to invalid eventName: "+e):this._queue.push(["timeEvent",[e,t]]))}},{key:"getDeviceId",value:function(){return systemInformation.properties.$device_id}},{key:"enableTracking",value:function(e){this.enabled=e,this.store._set("ta_enabled",e)}},{key:"optOutTracking",value:function(){this.store.setSuperProperties({},!0),this.store.setDistinctId(_.UUID()),this.store.setAccountId(null),this._queue.splice(0,this._queue.length),this.isOptOut=!0,this.store._set("ge_isOptOut",!0)}},{key:"optOutTrackingAndDeleteUser",value:function(){var e=new Date;this._sendRequest({type:"user_del"},e),this.optOutTracking()}},{key:"optInTracking",value:function(){this.isOptOut=!1,this.store._set("ge_isOptOut",!1)}},{key:"setTrackStatus",value:function(e){switch(e){case"PAUSE":this.eventSaveOnly=!1,this.optInTracking(),this.enableTracking(!1);break;case"STOP":this.eventSaveOnly=!1,this.optOutTracking(!0);break;default:this.eventSaveOnly=!1,this.optInTracking(),this.enableTracking(!0)}}},{key:"getCommonOpenId",value:function(o,a){var s=this;return new Promise(function(){var n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var r,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o){e.next=3;break}return e.abrupt("return",n("code is required"));case 3:return i="https://backend.gravity-engine.com/event_center/api/v1/base/".concat(a,"/code2Session/?access_token=").concat(s.accessToken),e.next=6,s.sendNetWork(i,{code:o});case 6:return i=e.sent,e.abrupt("return",0===i.code&&null!=i&&null!=(r=i.data)&&r.resp?t(i.data.resp):n(i));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",n(e.t0));case 13:case"end":return e.stop()}},e,null,[[0,10]])}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getWechatOpenId",value:function(e){return this.getCommonOpenId(e,"wx")}},{key:"getKuaishouOpenId",value:function(e){return this.getCommonOpenId(e,"ks")}},{key:"getDouyinOpenId",value:function(e){return this.getCommonOpenId(e,"dy")}},{key:"getBilibiliOpenId",value:function(e){return this.getCommonOpenId(e,"bili")}},{key:"tencentSDKRegisterTrack",value:function(){var t=this;this.sdk&&this.appId&&this.checkUserInfo().then(function(e){var e=(null==e||null==(e=e.data)?void 0:e.action)||"";"register"===e?(t.sdk.onRegister(),logger.tencentSdkLog("onRegister"),t.setupUserInfo("register")):"re_active"===e&&"number"==typeof(null==(e=t.config)||null==(e=e.tencentSdkData)?void 0:e.silentPeriod)&&(t.sdk.track("RE_ACTIVE",{backFlowDay:t.config.tencentSdkData.silentPeriod}),logger.tencentSdkLog("track RE_ACTIVE"),t.setupUserInfo("re_active"))})}},{key:"checkUserInfo",value:function(){var e,i=this,o=(null==(e=this.config)||null==(e=e.tencentSdkData)?void 0:e.silentPeriod)||7;return new Promise(function(){var n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://backend.gravity-engine.com/event_center/api/v1/event/tencent_sdk/?access_token=".concat(i.accessToken,"&client_id=").concat(i.appId,"&backFlowDay=").concat(o),e.next=3,i.sendNetWork(r,{},"get");case 3:return r=e.sent,e.abrupt("return",(0===r.code?t:n)(r));case 5:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"setupUserInfo",value:function(i){var o=this;return new Promise(function(){var n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",n("action is required"));case 2:return r="https://backend.gravity-engine.com/event_center/api/v1/event/tencent_sdk/?access_token=".concat(o.accessToken,"&client_id=").concat(o.appId),e.next=5,o.sendNetWork(r,{postback_list:[{action:i}]},"post");case 5:return r=e.sent,e.abrupt("return",(0===r.code?t:n)(r));case 7:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"queryDryRunInfo",value:function(i){var o=this;return new Promise(function(){var n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(i?"&trace_id=".concat(i):""),r="https://backend.gravity-engine.com/event_center/api/v1/event/postback_info/?access_token=".concat(o.accessToken,"&client_id=").concat(o.appId).concat(r),e.next=4,o.sendNetWork(r,{},"get");case 4:return r=e.sent,e.abrupt("return",(0===r.code?t:n)(r));case 6:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"sendDryRunResult",value:function(i,o){var a=this;return new Promise(function(){var n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",n("traceId is required"));case 2:if(o){e.next=4;break}return e.abrupt("return",n("action is required"));case 4:return r="https://backend.gravity-engine.com/event_center/api/v1/event/postback_info/?access_token=".concat(a.accessToken,"&client_id=").concat(a.appId),e.next=7,a.sendNetWork(r,{postback_list:[{trace_id:i,action:o}]},"post");case 7:return r=e.sent,e.abrupt("return",(0===r.code?t:n)(r));case 9:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"payEventToTencent",value:function(e){this.sdk&&(this.sdk.onPurchase(e),logger.tencentSdkLog("onPurchase"))}},{key:"getDryRunPostBackInfo",value:(s=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,r,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={click_company:"",postback_list:[],retry:0},e.prev=1,e.next=4,this.queryDryRunInfo(t);case 4:if(r=e.sent,null!==(r=(null==r?void 0:r.data)||{})&&null!=(i=r.postback_list)&&i.length)return i=Number(null===r?void 0:r.retry)||n.retry,e.abrupt("return",{postback_list:r.postback_list,click_company:(null===r?void 0:r.click_company)||n.click_company,retry:0<=i?i:n.retry});e.next=9;break;case 9:return e.abrupt("return",n);case 12:return e.prev=12,e.t0=e.catch(1),e.abrupt("return",n);case 15:case"end":return e.stop()}},e,this,[[1,12]])})),function(e){return s.apply(this,arguments)})},{key:"_getIsDryRun",value:function(){var i=this;return new Promise(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://backend.gravity-engine.com/event_center/api/v1/base/appconf/?access_token=".concat(i.accessToken,"&conf_type=dryrun_mode"),e.prev=1,e.next=4,i.sendNetWork(n,{},"get");case 4:n=e.sent,r=0<(null==n||null==(r=n.data)||null==(r=r.dryrun_mode)?void 0:r.tencent),t(0===n.code&&r),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),t(!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])}));return function(e){return t.apply(this,arguments)}}())}},{key:"_setDryRunValue",value:(a=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.sdk||Reflect.has(this.config.tencentSdkData,"enableDryRun"))return e.abrupt("return");e.next=2;break;case 2:return e.next=4,_.sleep(t);case 4:if(Reflect.has(this.config.tencentSdkData,"enableDryRun"))return e.abrupt("return");e.next=6;break;case 6:return e.next=8,this._getIsDryRun();case 8:n=e.sent,this.config.tencentSdkData.enableDryRun=n;case 10:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"tryDryRun",value:(o=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,r,i,o,a,s,c,u,l,p,f;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===(n=t.actionList).length)return e.abrupt("return");e.next=3;break;case 3:return e.next=5,_.sleep(1e3);case 5:return e.next=7,this.getDryRunPostBackInfo("");case 7:o=e.sent,r=o.postback_list,i=o.retry,o=o.click_company,a=0;case 12:if(0===r.length&&a<i)return s=1e3*a+2e3,e.next=16,_.sleep(s);e.next=24;break;case 16:return e.next=18,this.getDryRunPostBackInfo("");case 18:s=e.sent,r=s.postback_list,o=s.click_company,a++,e.next=12;break;case 24:if("tencent"===o&&r.length){e.next=26;break}return e.abrupt("return");case 26:c=_createForOfIteratorHelper(r);try{for(c.s();!(u=c.n()).done;)"pay"===(l=u.value).action&&n.includes("pay")?(this.sdk.onPurchase(l.postback_value),logger.tencentSdkLog("onPurchase")):"tutorial_finish"===l.action&&n.includes("tutorial_finish")?this.onTutorialFinishEvent():"create_role"===l.action&&n.includes("create_role")?this.onCreateRoleEvent(l.role_name):"re_active"===l.action&&n.includes("re_active")?(this.sdk.track("RE_ACTIVE",{backFlowDay:l.re_active_day}),logger.tencentSdkLog("track RE_ACTIVE")):"register"===l.action&&n.includes("register")&&(this.sdk.onRegister(),logger.tencentSdkLog("onRegister"))}catch(e){c.e(e)}finally{c.f()}p=r.filter(function(e){return n.includes(e.action)}),f="https://backend.gravity-engine.com/event_center/api/v1/event/postback_info/?access_token=".concat(this.accessToken,"&client_id=").concat(this.appId),this.sendNetWork(f,{postback_list:p.map(function(e){return{trace_id:e.trace_id,action:e.action}})},"post");case 31:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"tryPayEventDryRun",value:(i=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sdk){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._setDryRunValue(200);case 4:this.config.tencentSdkData.enableDryRun?this.tryDryRun({actionList:["pay"]}):(this.sdk.onPurchase(t),logger.tencentSdkLog("onPurchase"));case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"tryTutorialFinishEventDryRun",value:(r=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sdk){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._setDryRunValue(200);case 4:this.config.tencentSdkData.enableDryRun?this.tryDryRun({actionList:["tutorial_finish"]}):this.onTutorialFinishEvent();case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"tryCreateRoleEventDryRun",value:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sdk){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._setDryRunValue(200);case 4:this.config.tencentSdkData.enableDryRun?this.tryDryRun({actionList:["create_role"]}):this.onCreateRoleEvent(t);case 5:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"tryRegisterEventDryRun",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sdk){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._setDryRunValue(200);case 4:this.config.tencentSdkData.enableDryRun?this.tryDryRun({actionList:["register"]}):this.tencentSDKRegisterTrack();case 5:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"onUpdateLevelEvent",value:function(e){this.sdk&&(this.sdk.track("UPDATE_LEVEL",{level:e}),logger.tencentSdkLog("track UPDATE_LEVEL")),this.track("$UpdateLevel",{$user_level:e})}},{key:"onRegisterEvent",value:function(){this.sdk&&(this.sdk.onRegister(),logger.tencentSdkLog("onRegister")),this.registerEvent()}},{key:"onCreateRoleEvent",value:function(e){this.sdk&&(this.sdk.onCreateRole(e),logger.tencentSdkLog("onCreateRole")),this.track("$CreateRole",{$role_name:e})}},{key:"onTutorialFinishEvent",value:function(){this.sdk&&(this.sdk.onTutorialFinish(),logger.tencentSdkLog("onTutorialFinish")),this.track("$TutorialFinish",{})}},{key:"onViewMallContentEvent",value:function(){this.sdk&&(this.sdk.track("VIEW_CONTENT",{item:"Mall"}),logger.tencentSdkLog("track VIEW_CONTENT Mall")),this.track("$ViewMallContent",{})}},{key:"onViewActivityContentEvent",value:function(){this.sdk&&(this.sdk.track("VIEW_CONTENT",{item:"Activity"}),logger.tencentSdkLog("track VIEW_CONTENT Activity")),this.track("$ViewActivityContent",{})}},{key:"onAddToWishListEvent",value:function(){this.sdk&&(this.sdk.track("ADD_TO_WISHLIST",{type:0<arguments.length&&void 0!==arguments[0]?arguments[0]:"default"}),logger.tencentSdkLog("track ADD_TO_WISHLIST")),this.track("$MPAddFavorites",{$url_path:""})}},{key:"onShareEvent",value:function(e){this.sdk&&(this.sdk.track("SHARE",{target:e}),logger.tencentSdkLog("track SHARE")),this.track("$MPShare",{$share_depth:1,$share_method:"转发消息卡片",$share_target:e})}}]),n}();module.exports=GravityEngineAPI;